Rs.ns("Rs.ext.state");(function(){Rs.ext.state.Provider=function(a){this.state={};Ext.apply(this,a||{});this.addEvents("statechange","load");Rs.ext.state.Provider.superclass.constructor.call(this);if(this.autoLoad===true){this.load()}else{if(Rs.isArray(this.autoLoad)&&this.autoLoad.length>0){this.load(this.autoLoad)}}this.on("statechange",this.sync,this,{scope:this,buffer:100})};Ext.extend(Rs.ext.state.Provider,Rs.util.Observable,{autoLoad:false,load:function(a,c,b){Rs.Service.call({url:this.url,method:"load",params:{modules:Rs.isArray(a)?a:[a]}},this.__onLoad.createDelegate(this,[c,b],3),b)},__onLoad:function(e,i,f,g){var h,d,b,a,c;Rs.each(e,function(j){d=j.moduleCode;b=j.schemeCode;j.stateData==undefined?j.stateData="":null;a=Rs.decode(j.stateData||"")||{};c=(j.defaultFlag===true);this.state[d]?null:this.state[d]={};this.state[d][b]?null:this.state[d][b]={};Rs.apply(this.state[d][b],{defaultFlag:c,stateData:a})},this);if(f&&Rs.isFunction(f)){f.call(g||this,e)}this.fireEvent("load",this,e)},sync:function(b,c,a){Rs.Service.call({url:this.url,method:c,params:a},this.onSync,this)},onSync:function(a){if(a!=true){Ext.Msg.alert("提示","操作失败")}},get:function(c,b,a){return Rs.isDefined(this.state[c])&&Rs.isObject(this.state[c])&&Rs.isDefined(this.state[c][b])?this.state[c][b]:a},getAll:function(a){return Ext.isDefined(this.state[a])&&Ext.isObject(this.state[a])?this.state[a]:{}},getDefaultSchemeCode:function(c){var a=this.state[c],d,b;if(a){for(d in a){b=a[d];if(b.defaultFlag===true){return d}}}},set:function(e,b,g,c){!Rs.isDefined(this.state[e])?this.state[e]={}:null;!Rs.isDefined(this.state[e][b])?this.state[e][b]={defaultFlag:false,stateData:""}:null;this.state[e][b]=Rs.apply(this.state[e][b],{stateData:g});Rs.apply(this.state[e][b],c||{});var a={},f={},h=this.state[e][b];f[b]=Rs.apply(Rs.apply({},h),{stateData:Rs.encode(h.stateData)});a[e]=f;this.fireEvent("statechange",this,"sync",{data:a})},rename:function(b,c,a){!Rs.isDefined(this.state[b])?this.state[b]={}:null;this.state[b][a]=Ext.apply({},this.state[b][c]||{defaultFlag:false,stateData:""});delete this.state[b][c];this.fireEvent("statechange",this,"rename",{moduleCode:b,newName:a,oldName:c})},setDefault:function(c,b){var a=this.state[c],e,d;if(a){for(e in a){d=a[e];if(d){if(e==b){d.defaultFlag=true;this.fireEvent("statechange",this,"setDefault",{moduleCode:c,schemeCode:b})}else{d.defaultFlag=false}}}}},clear:function(b,a){Rs.isDefined(this.state[b])&&Ext.isDefined(this.state[b][a])?delete this.state[b][a]:null;this.fireEvent("statechange",this,"clear",{moduleCode:b,schemeCode:a})},clearAll:function(a){Rs.isDefined(this.state[a])?delete this.state[a]:null;this.fireEvent("statechange",this,"clear",{moduleCode:a})}})})();Rs.ns("Rs.ext.state");(function(){Rs.ext.state.StateManager=function(){var a=new Rs.ext.state.Provider({url:"/rsc/rsclient/statemanager"});return{init:function(b,d,c){a.load(b,d,c)},setProvider:function(b){a=b},getProvider:function(){return a},get:function(d,c,b){return a.get(d,c,b)},getAll:function(b){return a.getAll(b)},getSchemeCount:function(d){var b=this.getAll(d),e,c=0;for(e in b){c++}return c},getDefaultSchemeCode:function(b){return a.getDefaultSchemeCode(b)},set:function(d,b,e,c){a.set(d,b,e,c)},rename:function(c,d,b){a.rename(c,d,b)},setDefault:function(c,b){a.setDefault(c,b)},clear:function(c,b){a.clear(c,b)},clearAll:function(b){a.clearAll(module)}}}()})();Rs.ns("Rs.ext.state");(function(){Rs.ext.state.StatePlugin=function(a){Ext.apply(this,a);Rs.ext.state.StatePlugin.superclass.constructor.call(this);this.addEvents("beforestaterestore","staterestore","beforestatesave","statesave","stateload");if(Rs.ext.state.StateManager&&this.scheme!==false&&Rs.isNumber(this.scheme)){this.button=new Ext.SplitButton({xtype:"splitbutton",iconCls:"rs-action-scheme",text:"创建方案",handler:this.createScheme,scope:this,menu:this.stateManagerMenu=new Ext.menu.Menu()});Rs.ext.state.StateManager.getProvider().on("statechange",this.syncStateMangerMenu,this,{single:true,delay:25});this.stateManagerMenu.on("beforeshow",this.syncStateMangerMenu,this)}};Ext.extend(Rs.ext.state.StatePlugin,Ext.util.Observable,{scheme:10,schemeMsg:"您不能再创建方案, 最多创建{0}个方案",init:function(a){this.comp=a;this.stateId=this.comp.getStateId();this.initStateEvents();this.initState()},getStateId:function(){return this.stateId},initStateEvents:function(){if(this.comp.stateEvents){for(var a=0,b;b=this.comp.stateEvents[a];a++){this.comp.on(b,this.saveScheme,this,{delay:100})}}},initState:function(){if(Rs.ext.state.StateManager){var c=this.getStateId(),b,a;if(c){Rs.ext.state.StateManager.init(c,function(){b=Rs.ext.state.StateManager.getDefaultSchemeCode(c);this.fireEvent("stateload",this,b);if(b){a=Rs.ext.state.StateManager.get(c,b);if(a&&this.fireEvent("beforestaterestore",this,a)!==false){this.applyScheme(b,a);this.fireEvent("staterestore",this,a)}}},this)}}},createScheme:function(){var b=this.getStateId(),a=Rs.ext.state.StateManager.getSchemeCount(b);if((Rs.isNumber(this.scheme)&&this.scheme>a)||this.scheme===true){Ext.Msg.prompt("创建方案","请输入方案名称",function(c,d){if(c=="ok"&&!Rs.isEmpty(d,false)&&d.length<=30){if(Rs.isNumber(this.scheme)){this.currentSchemeCode=d;this.saveScheme()}}},this)}else{Ext.Msg.alert("提示",String.format(this.schemeMsg,a))}},saveScheme:function(){if(Rs.ext.state.StateManager){var d=this.getStateId(),b=this.currentSchemeCode||this.getStateId(),a=this.scheme!=false?null:{defaultFlag:true};if(d){var c=this.comp.getState();if(this.fireEvent("beforestatesave",this,d,b,c)!==false){Rs.ext.state.StateManager.set(d,b,c,a);this.fireEvent("statesave",this,d,b,c)}}}},applyScheme:function(b,a){this.currentSchemeCode=b;if(a&&a.stateData){this.comp.applyState(a.stateData)}},renameScheme:function(a){Ext.Msg.prompt("提示","请输入新名称",function(b,c){if(b=="ok"){if(a!=c&&!Rs.isEmpty(c,false)&&c.length<=30){var d=this.getStateId();if(this.currentSchemeCode==a){this.currentSchemeCode=c}Rs.ext.state.StateManager.rename(d,a,c)}}},this,false,a)},setDefaultScheme:function(a){var b=this.getStateId();if(b&&a){Rs.ext.state.StateManager.setDefault(b,a)}},deleteScheme:function(a){Ext.Msg.show({title:"提示",msg:"您确定要删除该方案吗?",buttons:Ext.Msg.YESNO,fn:function(b){if(b==="yes"){var c=this.getStateId();if(c&&a){Rs.ext.state.StateManager.clear(c,a)}}},animEl:"elId",icon:Ext.MessageBox.QUESTION,scope:this})},syncStateMangerMenu:function(){var f=this.getStateId(),a=Rs.ext.state.StateManager.getAll(f),e,c,b,d;this.stateManagerMenu.removeAll();for(e in a){c=a[e];b=(this.currentSchemeCode===e);d=(c.defaultFlag===true);this.stateManagerMenu.add({text:e,cls:(d?"rs-state-default-scheme":"")+(b?" rs-state-current-scheme":""),handler:this.applyScheme.createDelegate(this,[e,Rs.ext.state.StateManager.get(f,e)]),scope:this,menu:new Ext.menu.Menu({items:[{text:"应用",disabled:b?true:false,handler:this.applyScheme.createDelegate(this,[e,Rs.ext.state.StateManager.get(f,e)]),scope:this},{text:"重命名",handler:this.renameScheme.createDelegate(this,[e]),scope:this},{text:"设为默认",disabled:d?true:false,handler:this.setDefaultScheme.createDelegate(this,[e]),scope:this},{text:"保存",disabled:b?false:true,handler:this.saveScheme,scope:this},{text:"删除",handler:this.deleteScheme.createDelegate(this,[e]),scope:this}]})})}return this.stateManagerMenu.items.length>=1}})})();Ext.ns("Rs.ext.query");(function(){Rs.ext.query.QueryPanel=function(a){Ext.apply(this,a||{layout:"column"});if(this.isPop){this.bbar=new Ext.Toolbar({items:["->"]})}this.editors={};Rs.ext.query.QueryPanel.superclass.constructor.call(this,a);this.addEvents("beforeselectcondition","selectcondition","beforeunselectcondition","unselectcondition","beforequery","query","reset");this.on("resize",function(){if(this.ownerCt){this.ownerCt.doLayout()}},this,{delay:10})};Ext.extend(Rs.ext.query.QueryPanel,Ext.Panel,{animCollapse:false,isPop:false,bodyCfg:{cls:"rs-query-panel-body"},bodyStyle:"padding:5px;",cls:"rs-query-panel",autoHeight:true,autoScroll:true,defaults:{border:false},layout:"column",initComponent:function(){Rs.ext.query.QueryPanel.superclass.initComponent.call(this);this.addActionsButtons();if(Ext.isArray(this.conditions)){var b=this.conditions;for(var a=0;a<b.length;a++){if(b[a].editor){this.addConditionToPanel(b[a]);this.addConditionToMenu(b[a],!b[a].hidden)}}}},addConditionToPanel:function(d){var b=false;if(this.items){this.items.each(function(c){if(c.dataIndex==d.dataIndex){c.show();try{this.syncSize()}catch(f){}b=true;return false}},this);if(b){return}}var a={};if(!d.editor.isXType){a=Ext.create(Ext.apply(d.editor||{},{fieldLabel:d.header,labelStyle:"text-align:right;",width:120}),"textfield")}else{a=Ext.apply(d.editor,{labelStyle:"text-align:right;",fieldLabel:d.header,width:120})}this.editors[d.dataIndex]=a.id;this.add({layout:"form",bodyCfg:{cls:"rs-query-panel-body"},width:230,dataIndex:d.dataIndex,hidden:d.hidden,items:[a]});if(this.rendered){this.syncSize()}},getEditor:function(a){return this.findById(this.editors[a])},removeConditionFromPanel:function(a){this.items.each(function(b){if(b.dataIndex==a){b.hide();this.syncSize();return false}},this)},addActionsButtons:function(){var a=this.getBottomToolbar()||this.getTopToolbar()||this;a.addButton({iconCls:"rs-action-condition",text:"条件",scope:this,menu:this.addConditonMenu=new Ext.menu.Menu()});a.addButton({iconCls:"rs-action-reset",text:"重置",handler:this.resetConditions,scope:this});a.addButton({iconCls:"rs-action-query",text:"查询",handler:this.doQuery,scope:this})},addConditionToMenu:function(c,b){if(!c){return}var a=this.addConditonMenu.add({text:c.header||c.dataIndex,dataIndex:c.dataIndex,condition:c,checked:b,hideOnClick:false,handler:this.onConditionMenuClick,scope:this})},onConditionMenuClick:function(a,b){if(a.checked){this.removeConditionFromPanel(a.dataIndex);this.fireEvent("unselectcondition",this,a)}else{this.addConditionToPanel(a.condition);this.fireEvent("selectcondition",this,a)}},resetConditions:function(){this.items.each(function(a){a.items.items[0].reset()},this);if(this.store){this.store.load()}this.fireEvent("reset",this)},bindStore:function(b,c,a){this.store=b;this.queryCallback=c;this.queryScope=a},bindNode:function(a){this.node=a},bindGeneralselPanel:function(a){this.gPanel=a},getParams:function(){var a={};this.items.each(function(c){if(!c.hidden){var b=c.items.items[0].getValue();if(!Ext.isEmpty(b)){a[c.dataIndex]=b}}},this);return a},doQuery:function(){if(!this.preDoQuery()){return}var g=this.getParams();if(g&&this.fireEvent("beforequery",this,g)!==false){if(this.store){if(this.queryCallback){var f=this.getSQL(g);this.queryCallback.call(this.queryScope,f)}else{Ext.apply(g,this.store.baseParams||this.grid.store.baseParams||{});this.store.load({params:g})}}else{if(this.grid&&this.grid.store){if(this.queryCallback){var f=this.getSQL(g);this.queryCallback.call(this.queryScope,f)}else{Ext.apply(g,this.grid.store.baseParams||{});g.metaData.start=0;this.grid.store.load({params:g})}}else{if(this.node){if(this.nodeBaseParams){var e=this.nodeBaseParams,c=this.node.getLoader().baseParams,d;for(d in e){c[d]?delete c[d]:null}}this.node.collapse(true);while(this.node.firstChild){this.node.removeChild(this.node.firstChild,true);var b=this}this.node.loaded=false;this.node.loading=-1;Ext.apply(this.node.getLoader().baseParams,g);this.node.expand(false,false);this.nodeBaseParams=g}}}this.fireEvent("query",this,g)}},getSQL:function(b){var c=[];for(var a in b){c.push(a+" like '"+b[a]+"%'")}return c.join(" AND ")},preDoQuery:function(){var a=true;this.items.each(function(b){return a=b.items.items[0].validate()},this);return a},applyState:function(a){if(a&&a.conditions){this.resetConditions();this.addConditonMenu.items.each(function(b){if(a.conditions[b.dataIndex]!==undefined){b.setChecked(true);this.addConditionToPanel(b.condition)}else{b.setChecked(false);this.removeConditionFromPanel(b.dataIndex)}},this);this.setValue(a.conditions)}},setValue:function(a){for(var b in a){this.findById(this.editors[b]).setValue(a[b])}},getState:function(){var b={conditions:{}},a=0;this.addConditonMenu.items.each(function(c){if(c.checked){b.conditions[c.dataIndex]=this.findById(this.editors[c.dataIndex]).getValue()}},this);return b},destroy:function(){Rs.ext.query.QueryPanel.superclass.destroy.apply(this,arguments)}});Ext.ComponentMgr.registerType("rs-ext-querypanel",Rs.ext.query.QueryPanel)})();Ext.ns("Rs.ext.tree");(function(){Rs.ext.tree.TreeLoader=function(a){Ext.apply(this,a);Rs.ext.tree.TreeLoader.superclass.constructor.call(this)};Rs.extend(Rs.ext.tree.TreeLoader,Ext.tree.TreeLoader,{method:"load",getParams:function(b){var c=Rs.ext.tree.TreeLoader.superclass.getParams.call(this,b),a=[];if(Ext.isString(this.nodeAttrsParams)){a.push(this.nodeAttrsParams)}else{if(Ext.isArray(this.nodeAttrsParams)){Ext.each(this.nodeAttrsParams,function(d){if(Ext.isString(d)){a.push(d)}},this)}}return Ext.copyTo(c||{},b.attributes,a)},requestData:function(c,d,b){if(this.fireEvent("beforeload",this,c,d)!==false){if(this.directFn){var a=this.getParams(c);a.push(this.processDirectResponse.createDelegate(this,[{callback:d,node:c,scope:b}],true));this.directFn.apply(window,a)}else{this.transId=Rs.Service.call({method:this.method,url:this.dataUrl||this.url,callback:this.handleResponse,scope:this,argument:{callback:d,node:c,scope:b},params:this.getParams(c)})}}else{this.runCallback(d,b||c,[])}},handleResponse:function(d,b,e){if(b===false){this.handleFailure(d)}else{this.transId=false;var c=d.argument;this.processResponse(d,c.node,c.callback,c.scope);this.fireEvent("load",this,c.node,d)}}})})();Ext.ns("Rs.ext.tree");(function(){Rs.ext.tree.PagingTreeLoader=function(a){Ext.apply(this,a||{});this.clearOnLoad=false;Rs.ext.tree.PagingTreeLoader.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.tree.PagingTreeLoader,Rs.ext.tree.TreeLoader,{pageSize:20,moreNodeName:"",getParams:function(a){var c=Rs.ext.tree.PagingTreeLoader.superclass.getParams.call(this,a),b={start:0,limit:this.pageSize},d=a.lastChild;if(d!=undefined&&d.isMoreNode===true){b=d.getPagingInfo()}return Ext.apply(c,b)},processResponse:function(d,b,l,m){var o=d.responseText;try{var h=d.responseData||Ext.decode(o),g=h.nodes||[];b.beginUpdate();var c=this.getMoreNode(b,h);for(var f=0,j=g.length;f<j;f++){var a=this.createNode(g[f]);if(a){b.appendChild(a)}}if(c!=undefined){c.setChildrenInfo({childTotal:h.childTotal||b.childNodes.length,childCount:b.childNodes.length});b.appendChild(c)}b.endUpdate();this.runCallback(l,m||b,[b])}catch(k){this.handleFailure(d)}},getMoreNode:function(b,c){var e=c.nodes||[],a=c.childTotal||e.length,d=b.lastChild;if(d!=undefined){if(d.isMoreNode===true){b.removeChild(d,false)}else{d=undefined}}if(a>b.childNodes.length+e.length){if(d==undefined){d=this.createVirtualMoreNode(b)}return d}},createVirtualMoreNode:function(d){var b={},c;for(c in d.attributes){b[c]=undefined}return new Rs.ext.tree.PagingTreeMoreNode(Ext.apply(b,{text:this.moreNodeName,leaf:true}))}})})();(function(){Rs.ext.tree.PagingTreeMoreNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{onChilrenInfoChange:function(b,c,a){if(this.rendered){this.childrenInfo.innerHTML=c}},renderElements:function(i,c,h,b){this.indentMarkup=i.parentNode?i.parentNode.ui.getChildIndent():"";var g,d=this.getHref(c.href),e=['<li class="x-tree-node">','<div ext:tree-node-id="',i.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',c.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img alt="" src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<span class="x-tree-more-node x-tree-more-node-achor" unselectable="on"></span>','<span ext:qtip="加载下一页数据" class="x-tree-more-node x-tree-more-node-icon" unselectable="on"></span>','<span ext:qtip="加载所有数据" class="x-tree-more-node x-tree-more-node-all-icon" unselectable="on"></span>','<a hidefocus="on" class="x-tree-node-anchor" href="',d,'" tabIndex="1" ',c.hrefTarget?' target="'+c.hrefTarget+'"':"",'><span unselectable="on">',i.text,"</span></a>",'<span unselectable="on">',i.childrenInfoMsg,"</span>","</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");if(b!==true&&i.nextSibling&&(g=i.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",g,e)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",h,e)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var f=this.elNode.childNodes;this.indentNode=f[0];this.ecNode=f[1];this.iconNode=f[2];this.moreNode=Ext.fly(f[3]);this.moreNode.on("click",function(){this.node.appendPagingNodes()},this);this.moreAllNode=Ext.fly(f[4]);this.moreAllNode.on("click",function(){this.node.appendAllPagingNodes()},this);this.anchor=f[5];this.textNode=f[5].firstChild;this.childrenInfo=f[6]}});Rs.ext.tree.PagingTreeMoreNode=function(a){Ext.apply(this,a||{});Rs.ext.tree.PagingTreeMoreNode.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.tree.PagingTreeMoreNode,Ext.tree.TreeNode,{isMoreNode:true,defaultUI:Rs.ext.tree.PagingTreeMoreNodeUI,childrenInfoMsg:"",displayChildrenInfo:"当前显示{0}个,共{1}个",setChildrenInfo:function(a){this.childrenInfo=a;this.childrenInfoMsg=String.format(this.displayChildrenInfo,a.childCount,a.childTotal);this.ui.onChilrenInfoChange(this,this.childrenInfoMsg)},setPagingInfo:function(a){this.pagingInfo=a},getPagingInfo:function(){return this.pagingInfo},appendPagingNodes:function(){var a=this.getOwnerTree();loader=a&&a.loader?a.loader:null;this.setPagingInfo({start:this.childrenInfo.childCount,limit:loader?loader.pageSize:20});this.onAppendPagingNodes()},appendAllPagingNodes:function(){var a=this.childrenInfo.childTotal,b=this.childrenInfo.childCount;this.setPagingInfo({start:b,limit:a-b});this.onAppendPagingNodes()},onAppendPagingNodes:function(){var a=this.parentNode;if(a){a.childrenRendered=true;a.loaded=false;a.expand(false,false)}}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Proxy=function(a){this.serviceUrl={read:a.readUrl||a.url,create:a.createUrl||a.url,update:a.updateUrl||a.url,destroy:a.destroyUrl||a.url};this.serviceMethod={read:a.readMethod||"read",create:a.createMethod||"create",update:a.updateMethod||"update",destroy:a.destroyMethod||"destroy"};delete a.readUrl;delete a.readMethod;delete a.createUrl;delete a.createMethod;delete a.updateUrl;delete a.updateMethod;delete a.destroyUrl;delete a.destroyMethod;this.useAjax=!a||!a.events;Rs.ext.data.Proxy.superclass.constructor.call(this,a);var c=Ext.data.Api.actions;this.activeRequest={};for(var b in c){this.activeRequest[c[b]]=undefined}this.service=new Rs.data.Service({autoAbort:false})};Ext.extend(Rs.ext.data.Proxy,Ext.data.DataProxy,{api:{read:"read",update:"update",create:"create",destroy:"destroy"},doRequest:function(f,d,h,c,b,e,a){var g={url:this.serviceUrl[f],method:this.serviceMethod[f],request:{callback:b,scope:e,arg:a},params:{params:h||h.jsonData||h.xmlData||{}},reader:c,callback:this.createCallback(f,d),scope:this};if(this.activeRequest[f]){}this.activeRequest[f]=this.service.call(g)},createCallback:function(b,a){return function(i,c,e,f,g,h,d){this.activeRequest[b]=undefined;if(!i){if(b===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,h,d,e,f,g)}this.fireEvent("exception",this,"response",b,h,d,e,f,g);h.request.callback.call(h.request.scope,null,h.request.arg,false);return}if(b===Ext.data.Api.actions.read){this.onRead(b,h,c)}else{this.onWrite(b,h,c,a)}}},onRead:function(d,g,b){var a;try{a=g.reader.read(b)}catch(f){this.fireEvent("loadexception",this,g,b,f);this.fireEvent("exception",this,"response",d,g,b,f);g.request.callback.call(g.request.scope,null,g.request.arg,false);return}if(a.success===false){this.fireEvent("loadexception",this,g,b);var c=g.reader.readResponse(d,b);this.fireEvent("exception",this,"remote",d,g,c,null)}else{this.fireEvent("load",this,g,g.request.arg)}g.request.callback.call(g.request.scope,a,g.request.arg,a.success)},onWrite:function(f,h,c,b){var a=h.reader;var d;try{d=a.readResponse(f,c)}catch(g){this.fireEvent("exception",this,"response",f,h,c,g);h.request.callback.call(h.request.scope,null,h.request.arg,false);return}if(d.success===true){this.fireEvent("write",this,f,d.data,d,b,h.request.arg)}else{this.fireEvent("exception",this,"remote",f,h,d,b)}h.request.callback.call(h.request.scope,d.data,d,d.success)},destroy:function(){if(!this.useAjax){this.conn.abort()}else{if(this.activeRequest){var b=Ext.data.Api.actions;for(var a in b){if(this.activeRequest[b[a]]){Rs.Service.abort(this.activeRequest[b[a]])}}}}Rs.ext.data.Proxy.superclass.destroy.call(this)}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Reader=function(){Rs.ext.data.Reader.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.data.Reader,Ext.data.JsonReader,{read:function(a){if(!a){throw {message:"JsonReader.read: Json object not found"}}return this.readRecords(a)}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Writer=function(){Rs.ext.data.Writer.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.data.Writer,Ext.data.JsonWriter,{writeAllFields:false,encodeDelete:true,render:function(b,c,a){Ext.apply(b,c);b[this.meta.root]=a}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Store=function(b){var j=b.idProperty?b.idProperty:b.reader?b.reader.idProperty:"id",i=b.root?b.root:b.reader?b.reader.root:"data",f=b.fields?Ext.data.Record.create(b.fields):cofnig.reader?b.reader.fields:undefined,d=b.totalProperty||"total",a=b.successProperty||"success",g=b.messageProperty||"message",h=b.proxy||new Rs.ext.data.Proxy({url:b.url||b.readUrl||b.createUrl||b.updateUrl||b.destroyUrl,readUrl:b.readUrl,readMethod:b.readMethod,createUrl:b.createUrl,createMethod:b.createMethod,updateUrl:b.updateUrl,updateMethod:b.updateMethod,destroyUrl:b.destroyUrl,destroyMethod:b.destroyMethod}),c=b.writer||new Rs.ext.data.Writer({idProperty:j,listful:true}),e=new Rs.ext.data.Reader({idProperty:j,root:i,totalProperty:d,successProperty:a,messageProperty:g},f);Rs.ext.data.Store.superclass.constructor.call(this,Ext.apply(b,{proxy:h,writer:c,reader:e}));Ext.apply(this.baseParams,{metaData:Ext.apply({paramNames:this.paramNames},this.reader.meta)})};Ext.extend(Rs.ext.data.Store,Ext.data.Store,{remoteSort:true,autoSave:false,pruneModifiedRecords:true,load:function(c){c=Ext.apply({},c);this.storeOptions(c);if(this.sortInfo&&this.remoteSort){var b=this.paramNames,a={};a[b.sort]=this.sortInfo.field;a[b.dir]=this.sortInfo.direction;Ext.apply(this.baseParams.metaData,{sortInfo:a})}try{return this.execute("read",null,c)}catch(d){this.handleException(d);return false}},singleSort:function(f,c){var e=this.fields.get(f);if(!e){return false}var b=e.name,a=this.sortInfo||null,d=this.sortToggle?this.sortToggle[b]:null;if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")}else{c=e.sortDir}}this.sortToggle[b]=c;this.sortInfo={field:b,direction:c};this.hasMultiSort=false;if(this.remoteSort){if(!this.load(this.lastOptions)){}}else{this.applySort();this.fireEvent("datachanged",this)}return true}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.data.GroupingStore=function(d){d=d||{};this.hasMultiSort=true;this.multiSortInfo=this.multiSortInfo||{sorters:[]};var e=this.multiSortInfo.sorters,c=d.groupField||this.groupField,b=d.sortInfo||this.sortInfo,a=d.groupDir||this.groupDir;if(c){e.push({field:c,direction:a})}if(b){e.push(b)}Rs.ext.data.GroupingStore.superclass.constructor.call(this,d);this.addEvents("groupchange");this.applyGroupField()};Ext.extend(Rs.ext.data.GroupingStore,Rs.ext.data.Store,{remoteGroup:true,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;delete this.baseParams.groupDir}var a=this.lastOptions;if(a&&a.params){delete a.params.groupBy;delete a.params.groupDir}this.reload()}else{this.sort();this.fireEvent("datachanged",this)}},groupBy:function(e,a,d){d=d?(String(d).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;if(this.groupField==e&&this.groupDir==d&&!a){return}var c=this.multiSortInfo.sorters;if(c.length>0&&c[0].field==this.groupField){c.shift()}this.groupField=e;this.groupDir=d;this.applyGroupField();var b=function(){this.fireEvent("groupchange",this,this.getGroupState())};if(this.groupOnSort){this.sort(e,d);b.call(this);return}if(this.remoteGroup){this.on("load",b,this,{single:true});this.reload()}else{this.sort(c);b.call(this)}},sort:function(g,c){if(this.remoteSort){return Ext.data.GroupingStore.superclass.sort.call(this,g,c)}var f=[];if(Ext.isArray(arguments[0])){f=arguments[0]}else{if(g==undefined){f=this.sortInfo?[this.sortInfo]:[]}else{var e=this.fields.get(g);if(!e){return false}var b=e.name,a=this.sortInfo||null,d=this.sortToggle?this.sortToggle[b]:null;if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")}else{c=e.sortDir}}this.sortToggle[b]=c;this.sortInfo={field:b,direction:c};f=[this.sortInfo]}}if(this.groupField){f.unshift({direction:this.groupDir,field:this.groupField})}return this.multiSort.call(this,f,c)},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}}var a={groupBy:this.groupField,groupDir:this.groupDir};Ext.apply(this.baseParams.metaData,{groupInfo:a});var b=this.lastOptions;if(b&&b.params){b.params.groupDir=this.groupDir;delete b.params.groupBy}}},applyGrouping:function(a){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);return true}else{if(a===true){this.fireEvent("datachanged",this)}return false}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField}});Ext.reg("rs-ext-groupingstore",Rs.ext.data.GroupingStore)})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.GeneralselStore=function(d){d=d||{};var a=d.progCode,c=d.progCondition;if(Ext.isEmpty(a,false)){throw"progCode is null"}var b=d.url||"/rsc/rsclient/generalsel",e=Ext.apply(d.baseParams||{},{progCode:a});Rs.ext.data.GeneralselStore.superclass.constructor.call(this,Ext.apply(d,{url:b,baseParams:e,baseProgCondition:c}))};Ext.extend(Rs.ext.data.GeneralselStore,Rs.ext.data.Store,{loadMetaData:true,load:function(a){a=Ext.apply({},a);if(!a.params){a.params={}}Ext.apply(a.params,{progCondition:this.joinProgCondition(a.params)});Ext.apply(this.baseParams.metaData,{loadMetaData:this.loadMetaData===true});Rs.ext.data.GeneralselStore.superclass.load.apply(this,arguments)},joinProgCondition:function(e){var f=this.baseProgCondition,b=e?e.progCondition:undefined;if(Ext.isEmpty(b,false)){return f||""}else{if(Ext.isEmpty(f,false)){return b||""}else{var a=this.splitProgCondition(b),g=this.splitProgCondition(f),h=[],c,i=Ext.apply(a||{},g);for(var d in i){c=i[d];if(c&&!Ext.isEmpty(c,false)){h.push(i[d])}}if(h.length>0){return h.join(" AND ")}}}},splitProgCondition:function(g){var d={},h,f,e,k,j,a=new Array();for(f=0,e=g.length;f<e;f++){if(g.substring(f,f+3).toUpperCase()=="AND"){if(a.length>0){this.buildConditionBlock(d,a.join(""));a=new Array()}f=f+3}else{k=g.charAt(f);if(k=="("){if(a.length>0){this.buildConditionBlock(d,a.join(""));a=new Array()}j=0;while(true&&f<e){k=g.charAt(f++);a[a.length]=k;(k=="(")?(j++):null;(k==")")?(j--):null;if(j==0){break}}this.buildConditionBlock(d,a.join(""));a=new Array()}else{a[a.length]=k}}}if(a.length>0){this.buildConditionBlock(d,a.join(""))}return d},buildConditionBlock:function(a,c){var b=c.replace(/\s/gi,"");a[b]=c;return a},loadRecords:function(c,a,b){Rs.ext.data.GeneralselStore.superclass.loadRecords.apply(this,arguments);this.loadMetaData=false},setProgCode:function(a,b){if(Ext.isEmpty(a,false)){Rs.error("progCode is empty!")}this.progCode=a;this.baseProgCondition=b;Ext.apply(this.baseParams||{},{progCode:this.progCode});delete this.lastOptions;this.loadMetaData=true},getProgCode:function(){return this.progCode},getProgCondition:function(){return this.progCondition||""}})})();Ext.namespace("Rs.ext.grid");(function(){Rs.ext.grid.SliderPagingToolbar=function(a){Rs.ext.grid.SliderPagingToolbar.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.grid.SliderPagingToolbar,Ext.PagingToolbar,{minPageSize:10,maxPageSize:100,pageSizeIncrement:10,pageSize:20,paramNames:{start:"start",limit:"limit"},beforePageText:"第",afterPageText:"页(共{0}页)",firstText:"第一页",lastText:"最后一页",nextText:"下一页",prevText:"上一页",refreshText:"刷新",hasSlider:true,initComponent:function(){Rs.ext.grid.SliderPagingToolbar.superclass.initComponent.apply(this,arguments);if(this.hasSlider===true){this.sliderField=new Ext.form.SliderField({width:100,animate:true,increment:this.pageSizeIncrement,minValue:this.minPageSize,maxValue:this.maxPageSize,tipText:function(c){return"每页显示"+String(c.value)+"项"}});var b=this.items.indexOf(this.refresh);var a=new Ext.Toolbar.Separator();this.items.insert(b+1,a);this.items.insert(b+2,this.sliderField);this.sliderField.setValue(this.pageSize,false);this.setPageSizeTask=new Ext.util.DelayedTask(this.setPageSize,this);this.sliderField.slider.on("changecomplete",this.onPageSizeChanged,this)}},onPageSizeChanged:function(b,a){this.pageSize=a;this.setPageSizeTask.delay(50)},setPageSize:function(){this.cursor=Math.floor(this.cursor/this.pageSize)*this.pageSize;var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.limit]=this.pageSize;Ext.apply(this.store.baseParams,{metaData:b});this.doLoad(this.cursor)},bindStore:function(a,c){if(a){var b=this.getParams(),d=a.baseParams.metaData||{};d[b.limit]=this.pageSize;Ext.apply(a.baseParams,{metaData:d})}Rs.ext.grid.SliderPagingToolbar.superclass.bindStore.apply(this,arguments)},onLoad:function(a,e,i){if(!this.rendered){this.dsLoaded=[a,e,i];return}var b=this.getParams(),f=a.baseParams.metaData;this.cursor=(f&&f[b.start])?f[b.start]:0;var h=this.getPageData(),c=h.activePage,g=h.pages;this.afterTextItem.setText(String.format(this.afterPageText,h.pages));this.inputItem.setValue(c);this.first.setDisabled(c==1);this.prev.setDisabled(c==1);this.next.setDisabled(c==g);this.last.setDisabled(c==g);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,h)},doLoad:function(d){var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.start]=d;Ext.apply(this.store.baseParams,{metaData:b});var c=this.store.lastOptions?this.store.lastOptions.params||{}:{};if(this.fireEvent("beforechange",this,c)!==false){this.store.load({params:c})}},setStart:function(c){var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.start]=Ext.isNumber(c)?c:0;Ext.apply(this.store.baseParams,{metaData:b})},updateInfo:function(){if(this.displayItem){var a=this.store.getCount();var c=this.getPageData();if(c&&c.activePage>c.pages&&a==0){this.doLoad((c.pages-1)*this.pageSize);return}var b=a==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+a,this.store.getTotalCount());this.displayItem.setText(b)}}});Ext.ComponentMgr.registerType("rs-ext-sliderpagingtoolbar",Rs.ext.grid.SliderPagingToolbar)})();(function(){Rs.ext.grid.RowCellSelectionModel=function(a){Rs.ext.grid.RowCellSelectionModel.superclass.constructor.call(this,a);this.cellselection=null;this.addEvents("beforecellselect","cellselect","cellselectionchange")};Ext.extend(Rs.ext.grid.RowCellSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Rs.ext.grid.RowCellSelectionModel.superclass.initEvents.apply(this,arguments);this.grid.on("cellmousedown",this.handleCellMouseDown,this);this.grid.on(Ext.EventManager.getKeyEvent(),this.handleKeyDown,this);this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearCellSelections,beforerowsinserted:this.clearCellSelections});if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)}},beforeEdit:function(a){this.select(a.row,a.column,false,true,a.record)},onViewChange:function(){this.clearCellSelections(true)},onRowUpdated:function(a,b,c){if(this.cellselection&&this.cellselection.record==c){a.onCellSelect(b,this.cellselection.cell[1])}},handleCellMouseDown:function(b,d,a,c){if(c.button!==0||this.isLocked()){return}this.select(d,a)},select:function(f,c,b,e,d){if(this.fireEvent("beforecellselect",this,f,c)!==false){this.clearCellSelections();d=d||this.grid.store.getAt(f);this.cellselection={record:d,cell:[f,c]};if(!b){var a=this.grid.getView();a.onCellSelect(f,c);if(e!==true){a.focusCell(f,c)}}this.fireEvent("cellselect",this,f,c);this.fireEvent("cellselectionchange",this,this.cellselection)}},clearCellSelections:function(b){var a=this.cellselection;if(a){if(b!==true){this.grid.view.onCellDeselect(a.cell[0],a.cell[1])}this.cellselection=null;this.fireEvent("cellselectionchange",this,null)}},getSelectedCell:function(){return this.cellselection?this.cellselection.cell:null},hasCellSelection:function(){return this.cellselection?true:false},isSelectable:function(c,b,a){return !a.isHidden(b)},handleKeyDown:function(m){if(m.getKey()==m.C&&m.ctrlKey===true){var i=this.grid,l=this.cellselection,p,j,a;if(i&&l){p=i.getColumnModel();n=p.getColumnAt(l.cell[1]);j=n?n.dataIndex:undefined;a=l.record;if(a&&j){Rs.Clipboard.setData(a.get(j))}}return}if(!m.isNavKeyPress()){return}var d=m.getKey(),i=this.grid,u=this.cellselection,b=this,o=function(f,c,e){return i.walkCells(f,c,e,i.isEditor&&i.editing?b.acceptsNav:b.isSelectable,b)},t,h,a,n,q;switch(d){case m.ESC:case m.PAGE_UP:case m.PAGE_DOWN:break;default:m.stopEvent();break}if(!u){t=o(0,0,1);if(t){this.select(t[0],t[1])}return}t=u.cell;a=t[0];n=t[1];switch(d){case m.TAB:if(m.shiftKey){h=o(a,n-1,-1)}else{h=o(a,n+1,1)}break;case m.DOWN:h=o(a+1,n,1);break;case m.UP:h=o(a-1,n,-1);break;case m.RIGHT:h=o(a,n+1,1);break;case m.LEFT:h=o(a,n-1,-1);break;case m.ENTER:if(i.isEditor&&!i.editing){i.startEditing(a,n);return}break}if(h){a=h[0];n=h[1];this.select(a,n);if(i.isEditor&&i.editing){q=i.activeEditor;if(q&&q.field.triggerBlur){q.field.triggerBlur()}i.startEditing(a,n)}}}})})();(function(){Rs.ext.grid.CheckboxCellSelectionModel=function(a){Rs.ext.grid.CheckboxCellSelectionModel.superclass.constructor.call(this,a);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}};Ext.extend(Rs.ext.grid.CheckboxCellSelectionModel,Rs.ext.grid.RowCellSelectionModel,{checkOnly:true,header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",isColumn:true,initEvents:function(){Rs.ext.grid.CheckboxCellSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this)},this)},processEvent:function(b,d,c,f,a){if(b=="mousedown"){this.onMouseDown(d,d.getTarget());return false}else{return Ext.grid.Column.prototype.processEvent.apply(this,arguments)}},onMouseDown:function(c,b){if(c.button===0&&b.className=="x-grid3-row-checker"){c.stopEvent();var d=c.getTarget(".x-grid3-row");if(d){var a=d.rowIndex;if(this.isSelected(a)){this.deselectRow(a)}else{this.selectRow(a,true);this.grid.getView().focusRow(a)}}}},onHdMouseDown:function(c,a){if(a.className=="x-grid3-hd-checker"){c.stopEvent();var b=Ext.fly(a.parentNode);var d=b.hasClass("x-grid3-hd-checker-on");if(d){b.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{b.addClass("x-grid3-hd-checker-on");this.selectAll()}}},renderer:function(b,c,a){return'<div class="x-grid3-row-checker">&#160;</div>'},onEditorSelect:function(b,a){if(a!=b&&!this.checkOnly){this.selectRow(b)}},isSelectable:function(c,b,a){if(a.getColumnAt(b) instanceof Ext.grid.CheckboxSelectionModel){return false}else{return !a.isHidden(b)}}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.onLayout=this.onLayout;a.afterMethod("render",this.refreshSummary,this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("setSumValue",this.test,this);a.afterMethod("syncScroll",this.syncSummaryScroll,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);b.store.on("add",this.refreshSummary,this);b.store.on("remove",this.refreshSummary,this);b.store.on("clear",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(e,l){var h={},d={},n={},a,o,m=this.cm.config,b;for(var g=0,k=l.length;g<k;g++){o=l[g];b=m[g];for(var f=0,p=e.length;f<p;f++){a=e[f];if(b&&b.summaryType){if(!h[o.name]){h[o.name]={}}h[o.name][b.summaryType]=Rs.ext.grid.GridSummary.Calculations[b.summaryType](h[o.name][b.summaryType]||0,a,o.name,h[o.name][b.summaryType],h[o.name])}}}return h},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;if(this.view.summaryWrap){this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft}},doWidth:function(c,a,b){if(this.view.summary){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a}},doAllWidths:function(a,b){var d=this.view.summary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},putSumInfo:null,setSumValue:function(b){var f=this.view.getColumnData();var d=[],j,h={},g=f.length-1;for(var e=0,a=f.length;e<a;e++){j=f[e];h.id=j.id;h.style=j.style;h.css=e==0?"x-grid3-cell-first ":(e==g?"x-grid3-cell-last ":"");if(b&&b[j.name]){h.value=b[j.name]}else{h.value=""}if(h.value==undefined||h.value===""){h.value=" "}d[d.length]=this.cellTpl.apply(h)}if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.putSumInfo=this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:d.join("")});this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},refreshSumValue:function(){if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.cm.config;var e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");a.value=this.renderResultValue(b,a,d,k);if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},renderResultValue:function(b,d,e,f){if(b.summaryType||b.summaryRenderer){var a=Rs.ext.grid.GridSummary.SummaryRenderer[b.summaryType];if(e.data[f.name]){return(b.summaryRenderer||a||f.renderer)(e.data[f.name][b.summaryType],d,e)}else{return(b.summaryRenderer||a||f.renderer)(e.data[f.name],d,e)}}else{return""}},refreshSummary:function(){if(this.putSumInfo){this.refreshSumValue(this.putSumInfo);return}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",b,true)},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Rs.ext.grid.GridSummary.Calculations={sum:function(b,a,c){return b+Ext.num(a.data[c],0)},count:function(b,a,d,c){return c?++c:(c=1)},max:function(c,b,e,d){var c=b.data[e];var a=(d===undefined)||(d==0)?(d=c):d;return Math.max(c,a)},min:function(b,a,e,d){var b=parseFloat(a.data[e]);var c=(d===undefined)||(d==0)?(d=b):d;return Math.min(b,c)},average:function(b,a,f,e,h){var g=h.count_avg?++h.count_avg:(h.count_avg=1);var d=(h.total=(parseFloat(h.total||0)+(Ext.num(a.data[f]||0))));return d===0?0:d/g}};Rs.ext.grid.GridSummary.SummaryRenderer={count:function(a,c,b){return a!=null||a?"共"+a+"条":""},sum:function(a,c,b){return a!=null||a?"合计值:"+a:""},max:function(a,c,b){return a!=null||a?"最大值:"+a:""},min:function(a,c,b){return a!=null||a?"最小值:"+a:""},average:function(a,c,b){return a!=null||a?"平均值:"+a:""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GridPageSummary=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.GridPageSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.doRender=this.doRender.createDelegate(this);a.afterMethod("onUpdate",this.refreshPageSummary,this);a.afterMethod("onRemove",this.refreshPageSummary,this);b.store.on("add",this.refreshPageSummary,this);b.store.on("remove",this.refreshPageSummary,this);b.store.on("clear",this.refreshPageSummary,this);if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-pagesummary-cell-inner x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")}this.cellTpl.compile()},doRender:function(e,v,m,a,r,t){var h=this.view.templates,d=h.cell,y=h.row,o=r-1,b="width:"+this.view.getTotalWidth()+";",k=[],l=[],n={tstyle:b},q={},w=v.length,x,g,f,u,s,p;for(s=0;s<w;s++){f=v[s];l=[];p=s+a;for(u=0;u<r;u++){g=e[u];q.id=g.id;q.css=u===0?"x-grid3-cell-first ":(u==o?"x-grid3-cell-last ":"");q.attr=q.cellAttr="";q.style=g.style;q.value=g.renderer.call(g.scope,f.data[g.name],q,f,p,u,m);if(Ext.isEmpty(q.value)){q.value="&#160;"}if(this.markDirty&&f.dirty&&typeof f.modified[g.name]!="undefined"){q.css+=" x-grid3-dirty-cell"}l[l.length]=d.apply(q)}x=[];if(t&&((p+1)%2===0)){x[0]="x-grid3-row-alt"}if(f.dirty){x[1]=" x-grid3-dirty-row"}n.cols=r;if(this.getRowClass){x[2]=this.view.getRowClass(f,p,n,m)}n.alt=x.join(" ");n.cells=l.join("");k[k.length]=y.apply(n)}var c=Ext.get(this.view.mainBody.dom.childNodes[this.view.mainBody.dom.childNodes.length-1]);if(c&&c.hasClass&&c.hasClass("x-grid3-pagesummary-row")){c.remove()}k[k.length]=this.refreshSummary();return k.join("")},calculate:function(g,n){var l={},f={},p={},a,q,o=this.cm.config,d,b;var e=this.addline?this.addline:0;for(var k=0,m=n.length;k<m;k++){q=n[k];d=o[k];for(var h=0,s=g.length;h<s;h++){a=g[h];if(d&&d.summaryType){if(!l[q.name]){l[q.name]={}}l[q.name][d.summaryType]=Rs.ext.grid.GridSummary.Calculations[d.summaryType](l[q.name][d.summaryType]||0,a,q.name,l[q.name][d.summaryType],l[q.name])}}}return l},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft},doWidth:function(c,a,b){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a},doAllWidths:function(a,b){var d=this.view.summary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},putSumInfo:null,refreshSumValue:function(){if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},renderSummary:function(f,l){l=l||this.view.getColumnData();var m=this.cm.config;var g=[],q,b={},d,r=l.length-1,e={},n="width:"+this.view.getTotalWidth()+";",j={tstyle:n};for(var h=0,k=l.length;h<k;h++){q=l[h];d=m[h];b.id=q.id;b.style=q.style;b.css=h==0?"x-grid3-cell-first ":(h==r?"x-grid3-cell-last ":"");var s=d.summaryType;if(s||d.summaryRenderer){var a=Rs.ext.grid.GridPageSummary.SummaryRenderer[s];b.value=(d.summaryRenderer||a||q.renderer)(f.data[q.name][d.summaryType],b,f)}else{b.value=""}if(b.value==undefined||b.value===""){b.value="&#160;"}g[g.length]=this.cellTpl.apply(b)}j.alt="x-grid3-pagesummary-row";j.cells=g.join("");return j},refreshSummary:function(){if(this.putSumInfo){return this.putSumInfo}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);return this.pageSummary=this.view.templates.row.apply(b)},refreshPageSummary:function(){if(this.putSumInfo){return this.putSumInfo}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();if(this.pageSummary){var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);var h=this.view.mainBody.dom.childNodes[this.view.mainBody.dom.childNodes.length-1];h.innerHTML=this.view.templates.rowInner.apply(b)}},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Rs.ext.grid.GridPageSummary.SummaryRenderer={count:function(a,c,b){return a!=null||a?"共"+a+"条":""},sum:function(a,c,b){return a!=null||a?"合计值:"+a:""},max:function(a,c,b){return a!=null||a?"最大值:"+a:""},min:function(a,c,b){return a!=null||a?"最小值:"+a:""},average:function(a,c,b){return a!=null||a?"平均值:"+a:""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.HybridGridSummary=function(a){Rs.ext.grid.HybridGridSummary.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.grid.HybridGridSummary,Rs.ext.grid.GridSummary,{init:function(a){Rs.ext.grid.HybridGridSummary.superclass.init.apply(this,arguments)},calculate:function(a,b){var c=this.getSummaryData();return c||Rs.ext.grid.HybridGridSummary.superclass.calculate.call(this,a,b)},getSummaryData:function(){var b=this.grid.getStore().reader,d=b.jsonData,a=b.recordType.prototype.fields,c;if(d&&d.summaryData){c=d.summaryData;if(c){return this.extractValues(c,a.items,a.length)}}return null},extractValues:function(b,h,g){var c=this.grid.getStore().reader;var e=this.cm.config;var d,k={};for(var a=0;a<g;a++){d=h[a];var i=c.ef[a](b);k[d.name]=d.convert((i!==undefined)?i:d.defaultValue,b)}return k},updateSummaryData:function(c,b){var a=this.grid.getStore().reader.jsonData;if(!a.summaryData){a.summaryData={}}a.summaryData=c;if(!b){this.refreshSummary()}},renderResultValue:function(d,e,f,g){if(d.summaryType||d.summaryRenderer){var a=Rs.ext.grid.HybridGridSummary.SummaryRenderer[d.summaryType];var b;if(f.data[g.name]){b=(d.summaryRenderer||a||g.renderer)(f.data[g.name][d.summaryType],e,f)}else{b=(d.summaryRenderer||a||g.renderer)(f.data[g.name],e,f)}if(b.search("null")>-1){return""}else{if(b.search("共:0条")>-1){return""}}return b}else{return""}},refreshSummary:function(){if(this.putSumInfo){this.refreshSumValue(this.putSumInfo);return}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.view.totalsummary=this.view.totalsummaryWrap.insertHtml("afterbegin",b,true)},refreshSumValue:function(){if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.view.totalsummary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},setSumValue:function(b){var f=this.view.getColumnData();var d=[],j,h={},g=f.length-1;for(var e=0,a=f.length;e<a;e++){j=f[e];h.id=j.id;h.style=j.style;h.css=e==0?"x-grid3-cell-first ":(e==g?"x-grid3-cell-last ":"");if(b&&b[j.name]){h.value=b[j.name]}else{h.value=""}if(h.value==undefined||h.value===""){h.value=" "}d[d.length]=this.cellTpl.apply(h)}if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.putSumInfo=this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:d.join("")});this.view.totalsummary=this.view.totalsummaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-(this.summary?this.summary.getHeight():0)-this.totalsummary.getHeight())}},syncSummaryScroll:function(){Rs.ext.grid.HybridGridSummary.superclass.syncSummaryScroll.apply(this,arguments);var a=this.view.scroller.dom;if(this.view.totalsummaryWrap){this.view.totalsummaryWrap.dom.scrollLeft=a.scrollLeft;this.view.totalsummaryWrap.dom.scrollLeft=a.scrollLeft}},doWidth:function(c,a,b){Rs.ext.grid.HybridGridSummary.superclass.doWidth.apply(this,arguments);if(this.view.totalsummary){var d=this.view.totalsummary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a}},doAllWidths:function(a,b){var d=this.view.totalsummary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.totalsummary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e}});Rs.ext.grid.HybridGridSummary.SummaryRenderer={count:function(a,c,b){return a?a:""},sum:function(a,c,b){return a?a:""},max:function(a,c,b){return a?a:""},min:function(a,c,b){return a?a:""},average:function(a,c,b){return a?a:""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GroupSummary=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this,a);Rs.ext.grid.GroupSummary.superclass.constructor.call(this)},init:function(b){this.grid=b;var a=this.view=b.getView();a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.grid.getColumnModel().config,e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,k){var g={},a,m,l=this.grid.getColumnModel().config,b;for(var e=0,n=d.length;e<n;e++){a=d[e];for(var f=0,h=k.length;f<h;f++){m=k[f];b=l[f];if(b.summaryType){g[m.name]=Rs.ext.grid.GroupSummary.Calculations[b.summaryType](g[m.name]||0,a,m.name,g)}}}return g},doGroupEnd:function(a,d,b,f,c){var e=this.calculate(d.rs,b);a.push("</div>",this.renderSummary({data:e},b),"</div>")},doWidth:function(e,b,d){if(!this.isGrouped()){return}var c=this.view.getGroups(),a=c.length,f=0,g;for(;f<a;++f){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){if(!this.isGrouped()){return}var a=this.view.getGroups(),f=a.length,c=0,b,k,h,e=g.length;for(;c<f;c++){k=a[c].childNodes[2];k.style.width=d;k.firstChild.style.width=d;h=k.firstChild.rows[0].childNodes;for(b=0;b<e;b++){h[b].style.width=g[b]}}},doHidden:function(d,g,c){if(!this.isGrouped()){return}var b=this.view.getGroups(),a=b.length,e=0,f,h=g?"none":"";for(;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=h}},isGrouped:function(){return !Ext.isEmpty(this.grid.getStore().groupField)},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a))},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=Ext.getDom(d);if(!f){return false}var b=[];this.grid.getStore().each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData(),h=this.calculate(b,c),a=this.renderSummary({data:h},c),e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){this.refreshSummaryById(a._groupId)},doRemove:function(d,a,b,c){if(!c){this.refreshSummaryById(a._groupId)}},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a),c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Rs.ext.grid.GroupSummary.Calculations={sum:function(b,a,c){return b+(a.data[c]||0)},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=b.data[e];var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return c>a?(d[e+"max"]=c):a},min:function(b,a,e,d){var b=a.data[e];var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return b<c?(d[e+"min"]=b):c},average:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(a.data[f]||0)));return d===0?0:d/g}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.HybridGroupSummary=function(a){Rs.ext.grid.HybridGroupSummary.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.grid.HybridGroupSummary,Rs.ext.grid.GroupSummary,{calculate:function(b,d){var a=this.view.getGroupField(),c=b[0].data[a],e=this.getGroupSummaryData(c);return e||Rs.ext.grid.HybridGroupSummary.superclass.calculate.call(this,b,d)},updateSummaryData:function(a,d,c){var b=this.grid.getStore().reader.jsonData;if(!b.summaryData){b.summaryData={}}b.summaryData[a]=d;if(!c){this.refreshSummary(a)}},getGroupSummaryData:function(c){var b=this.grid.getStore().reader,e=b.jsonData,a=b.recordType.prototype.fields,d;if(e&&e.groupSummaryData){d=e.groupSummaryData[c];if(d){return b.extractValues(d,a.items,a.length)}}return null}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.ExportButton=Ext.extend(Ext.Button,{paging:false,text:"导出CSV文件",iconCls:"rs-action-export",visibleOnly:true,handler:function(){var b=this.grid.getStore();var c=b.lastOptions.params;if(typeof(c)=="undefined"){c=b.baseParams}this.header=this.getHeader();var a=new Rs.data.Service({url:b.readUrl||b.url,method:"export",accept:"json",timeout:3000000});this.setIconClass("rs-action-exporting");this.disable();this.removeClass(this.disabledClass);a.call({params:{params:Ext.apply({header:this.header,paging:this.paging},c)}},function(d){this.enable();this.setIconClass("rs-action-export");var e=Ext.fly(this.id+"-iframe");if(e){e.remove()}e=Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:this.id+"-iframe",style:"display:none",html:"<iframe src='/rsc/rsclient/export?sfilename="+d.filename+"&cfilename="+encodeURIComponent(encodeURIComponent(this.filename+".csv"))+"'></iframe>"})},this)},getHeader:function(){var f=[];var a=this.grid.getColumnModel();var e=a.getColumnCount();if(this.visibleOnly){for(var c=0;c<e;c++){if(!a.isHidden(c)){var b=a.getDataIndex(c);if(b){var d=[];d[0]=b;d[1]=a.getColumnHeader(c);d[2]=a.config[c].summaryType,f.push(d)}}}}else{for(var c=0;c<e;c++){var b=a.getDataIndex(c);if(b){var d=[];d[0]=b;d[1]=a.getColumnHeader(c);d[2]=a.config[c].summaryType,f.push(d)}}}return f}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.TreeColumn=function(a){a=Ext.apply(a||{},{});Rs.ext.grid.TreeColumn.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.grid.TreeColumn,Ext.grid.Column,{emptyIcon:Ext.BLANK_IMAGE_URL,renderer:function(l,c,i,d,h,m,j){var f=i.node,k=f.attributes,e,g=false,b=this.getHref(k.href);e=['<div class="x-tree-root-ct x-tree-arrows x-tree-root-node x-tree-node"><div ext:tree-node-id="',f.id,'" class="x-tree-node-el '+(f.isLeaf()?"x-tree-node-leaf":f.isExpandable()&&f.isExpanded()?"x-tree-node-expanded":"x-tree-node-collapsed")+" x-unselectable ",k.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.getChildIndent(f),"</span>",'<img alt="" src="',this.emptyIcon,'" class="x-tree-ec-icon '+(f.isLeaf()?"x-tree-elbow-end":f.isExpandable()&&f.isExpanded()?"x-tree-elbow-minus":"x-tree-elbow-plus")+'" />','<img alt="" src="',k.icon||this.emptyIcon,'" class="x-tree-node-icon',(k.icon?" x-tree-node-inline-icon":""),(k.iconCls?" "+k.iconCls:""),'" unselectable="on" />',g?('<input class="x-tree-node-cb" type="checkbox" '+(k.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b,'" tabIndex="1" ',k.hrefTarget?' target="'+k.hrefTarget+'"':"",'><span unselectable="on">',l,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</div>"];return e.join("")},getHref:function(a){return Ext.isEmpty(a)?(Ext.isGecko?"":"#"):a},getChildIndent:function(b){var a=[],c=b?b.parentNode:null;while(c){if(!c.isRoot||(c.isRoot&&c.ownerTree.rootVisible)){if(!c.isLast()){a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')}else{a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-icon" />')}}c=c.parentNode}return a.join("")},processEvent:function(b,g,a,h,j){var d=g.getTarget().className.match(/x-tree-ec-icon/);if(d){if(b=="click"||b=="mousedown"){var i=a.getStore(),f,c;if(i&&(f=i.getAt(h))&&(c=f.node)){if(c.isExpanded()){i.collapse(f,true)}else{i.expand(f)}}}}return Rs.ext.grid.TreeColumn.superclass.processEvent.apply(this,arguments)}});Ext.grid.Column.types.treecolumn=Rs.ext.grid.TreeColumn})();Ext.ns("Rs.ext.grid");(function(){var a=function(d,c){this.idProperty=d&&d.idProperty?d.idProperty:"id";delete d.idProperty;a.superclass.constructor.call(this,d);if(c!=undefined){this.record=c;c.node=this}this.addEvents("beforeexpand","expand","beforecollapse","collapse")};Ext.extend(a,Ext.tree.AsyncTreeNode,{isNode:true,loading:-1,getId:function(){return this.id},isExpanded:function(){return this.expanded===true},isLoaded:function(){return this.loading>0},setLoaded:function(c){c===true?(this.loading=1):null},isLoading:function(){return this.loading===0},setLoading:function(c){c===true?(this.loading=0):null},isLeaf:function(){return this.attributes.leaf===true},createNode:function(c){if(c&&c.isNode===true){return c}else{if(c.data!=undefined){var d=c.data;node=new a(Ext.apply(d,{id:d[this.idProperty],idProperty:this.idProperty}),c);return node}}},appendChild:function(f){var e=this,c,d;if(Ext.isArray(f)){for(c=0,d=f.length;c<d;c++){e.appendChild(f[c])}}else{f=e.createNode(f);if(f!=undefined){return a.superclass.appendChild.call(this,f)}}},expand:function(c,f,d){var e=this;if(!e.isLeaf()&&!e.isExpanded()){e.fireEvent("beforeexpand",e,function(g){e.expanded=true;e.fireEvent("expand",e,e.childNodes);if(c===true){e.expandChildren(true,f,d)}else{e.runCallback(f,d||e,[e.childNodes])}},d)}else{e.runCallback(f,d||e)}},expandChildren:function(f,k,l){var j=this,g=0,c=j.childNodes,h=c.length,e,d=0;for(;g<h;++g){e=c[g];if(!e.isLeaf()&&!e.isExpanded()){d++;c[g].expand(f,function(){d--;if(k&&!d){j.runCallback(k,l||j,j.childNodes)}},j)}}if(!d&&k){j.runCallback(k,l||j,j.childNodes)}},removeChild:function(d,c){Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);if(!c){var e=d.ui.rendered;if(e){d.ui.remove()}if(e&&this.childNodes.length<1){this.collapse(false,false)}else{this.ui.updateExpandIcon()}if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false}}return d},destroy:function(c){Ext.tree.TreeNode.superclass.destroy.call(this,c);Ext.destroy(this.ui,this.loader);this.ui=this.loader=null},collapse:function(c,f,d){var e=this;if(!e.isLeaf()&&e.isExpanded()){e.fireEvent("beforecollapse",e,function(g){e.expanded=false;if(c){e.collapseChildren(true,f,d);e.fireEvent("collapse",e,e.childNodes,false)}else{e.fireEvent("collapse",e,e.childNodes,false);e.runCallback(f,d||e,[e.childNodes])}},e)}else{e.runCallback(f,d||e)}},collapseChildren:function(f,k,l){var j=this,g=0,d=j.childNodes,h=d.length,e,c=0;for(;g<h;++g){e=d[g];if(!e.isLeaf()&&e.isExpanded()){c++;d[g].collapse(f,function(){c--;if(k&&!c){j.runCallback(k,l||j,j.childNodes)}})}}if(!c&&k){j.runCallback(k,l||j,j.childNodes)}},runCallback:function(c,e,d){if(Ext.isFunction(c)){c.apply(e,d)}}});var b=function(c){b.superclass.constructor.call(this,c)};Ext.extend(b,Ext.data.Tree,{proxyNodeEvent:function(j,g,f,e,c,o,n){if(j=="collapse"||j=="expand"||j=="beforecollapse"||j=="beforeexpand"||j=="move"||j=="beforemove"){j=j+"record"}if(j=="expandrecord"||j=="collapserecord"){var d=g.record,m=[];if(Ext.isArray(f)){for(var k=0,h=f.length;k<h;k++){if(f[k]!=undefined&&f[k].isNode&&f[k].record!=undefined){m.push(f[k].record)}}}else{if(f!=undefined&&f.isNode&&f.record!=undefined){m.push(f.record)}}return this.fireEvent(j,d,m,e,c,o,n)}else{var d=g.record;if(g.isRoot||d!=undefined){return this.fireEvent(j,d,f,e,c,o,n)}}}});Rs.ext.grid.TreeStore=function(e){var f=this,d,c;e=Ext.apply({},e);c=e.fields||f.fields;if(!c){e.fields=[{name:"text",type:"string"}]}f.tree=new Ext.data.Tree();f.tree=new b();d=f.root;if(d){delete f.root;f.setRootRecord(d)}f.tree.on({scope:f,remove:f.onRemoveRecord,beforeexpandrecord:f.onBeforeExpandRecord,expandrecord:f.onExpandRecord,beforecollapserecord:f.onBeforeCollapseRecord,collapserecord:f.onCollapseRecord,beforeinsertrecord:f.onBeforeExpandRecord,insertrecord:f.onExpandRecord,beforemoverecord:f.onBeforeMoveRecord,moverecord:f.onMoveRecord});this.autoLoad=false;Rs.ext.grid.TreeStore.superclass.constructor.call(this,Ext.apply(e,{root:this.defaultRootProperty}));f.relayEvents(f.tree,["append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert","expand","collapse","beforeexpand","beforecollapse","sort","rootchange"]);f.addEvents("rootchange");if(Ext.isDefined(f.nodeParameter)){f.nodeParam=f.nodeParameter;delete f.nodeParameter}};Ext.extend(Rs.ext.grid.TreeStore,Rs.ext.data.Store,{clearOnLoad:true,nodeParam:"node",defaultRootId:"root",defaultRootProperty:"children",folderSort:false,setRootNode:function(c){var d=this;c=c||{};if(!c.isNode){c=new a(Ext.apply(c,{id:d.defaultRootId,idProperty:this.idProperty}))}d.tree.setRootNode(c);if(!c.isLoaded()&&c.isExpanded()){d.load({node:c})}this.fireEvent("rootchange",d,c);return c},getRootNode:function(){var c=this.tree.getRootNode();if(c==undefined){c=this.setRootNode({expanded:true})}return c},getNodeById:function(c){return this.tree.getNodeById(c)},load:function(c){c=c||{};c.params=c.params||{};var e=this,d=c.node||e.getRootNode();if(!d){d=e.setRootNode({expanded:true})}if(e.clearOnLoad){d.removeAll()}Ext.applyIf(c,{node:d});c.params[e.nodeParam]=d?d.getId():"root";Ext.applyIf(c.params,d.getOwnerTree().getRootNode().getLoader().baseParams);if(d){d.setLoading(true)}return Rs.ext.grid.TreeStore.superclass.load.call(this,c)},fillNode:function(h,d){var g=this,f=d?d.length:0,e=0,c;h.setLoaded(true);for(;e<f;e++){h.appendChild(d[e])}return d},loadRecords:function(e,c,d){if(this.isDestroyed===true){return}if(!e||d===false){if(d!==false){this.fireEvent("load",this,[],c)}if(c.callback){c.callback.call(c.scope||this,[],c,false,e)}return}this.fillNode(c.node,e.records);if(c.callback){c.callback.call(c.scope||this,e.records,c,true)}},collapse:function(d,c,h,e){var g=this,f=d.node;if(f!=undefined){return f.collapse(c,h,e)}else{if(Ext.isFunction(h)){h.call(e||this)}}},expand:function(d,c,h,e){var g=this,f=d.node;if(f!=undefined){return f.expand(c,h,e)}else{if(Ext.isFunction(h)){h.call(e||this)}}},onBeforeExpandRecord:function(c,g,d){var f=this,e=c?c.node:f.getRootNode();if(e.isLoaded()){f.runCallback(g,d||e,[e.childNodes])}else{if(e.isLoading()){this.on("load",function(){f.runCallback(g,d||e,[e.childNodes])},this,{single:true})}else{this.load({node:e,callback:function(){f.runCallback(g,d||e,[e.childNodes])}})}}},onExpandRecord:function(d,c,h,g){var e=this.indexOf(d),f=c||[];if(d!=undefined){f.unshift(d);this.remove(d)}this.insert(e>=0?e:0,f)},onBeforeCollapseRecord:function(c,f,d){var e=c?c.node:this.getRootNode();f.call(d||e,e.childNodes)},onCollapseRecord:function(d,c,h,g){var f=c||[],e;if(d!=undefined){e=this.indexOf(d);f.unshift(d);this.remove(f);this.insert(e>=0?e:0,[d])}else{this.remove(f)}},onRemoveRecord:function(){},onBeforeMoveRecord:function(){},onMoveRecord:function(){},onCreateRecords:function(d,c,e){},onUpdateRecords:function(d,c,e){},onDestroyRecords:function(d,c,e){},sortData:function(){var g=this,d=this.hasMultiSort?this.multiSortInfo:this.sortInfo,i=d.direction||"ASC",h=d.sorters,f=[];if(!this.hasMultiSort){h=[{direction:i,field:d.field}]}f=this.createSortFunction(h);var c=g.getRootNode();c.cascade(function(j){if(!j.isLeaf()&&j.hasChildNodes()&&j.isExpanded()){j.sort(f)}},g);var e=[];c.cascade(function(j){if(!j.isRoot&&j.record&&j.parentNode.isExpanded()){e.push(j.record)}},g);g.removeAll();g.add(e)},sortChildNodes:function(d,c){var e=[].concat(d.childNodes);while(d.firstChild){var f=d.firstChild;f.remove()}var e=this.sortNodeList(e,c);d.appendChild(e)},sortNodeList:function(d,f){if(d.length==0){return[]}var g=d.sort(f);for(var e=0,c=g.length;e<c;e++){this.sortChildNodes(g[e],f)}return g},createSortFunction:function(d){var c=this.fields;return function(j,h){var f=j.record,e=h.record;for(var g=0;g<d.length;g++){var l=c.get(d[g].field).sortType;var m=l(f.data[d[g].field]),k=l(e.data[d[g].field]);if(m==k){continue}else{return(d[g].direction.toUpperCase()=="DESC"?-1:1)*(m>k?1:-1)}}return 0}},runCallback:function(c,e,d){if(Ext.isFunction(c)){c.apply(e,d)}},destroy:function(){if(!this.isDestroyed){var c=this.getRootNode();if(c&&c.destroy){c.destroy(true)}}Rs.ext.grid.TreeStore.superclass.destroy.apply(this,arguments)}})})();Ext.ns("Rs.ext.grid");(function(){var a=function(b){a.superclass.constructor.call(this,Ext.apply(b||{},{cellSelectorDepth:5}))};Ext.extend(a,Ext.grid.GridView,{autoScrollToTop:false,onLoad:function(){if(this.autoScrollToTop===true){a.superclass.onLoad.apply(this,arguments)}}});Rs.ext.grid.TreeGridPanel=function(b){Rs.ext.grid.TreeGridPanel.superclass.constructor.call(this,b)};Ext.extend(Rs.ext.grid.TreeGridPanel,Ext.grid.EditorGridPanel,{getView:function(){if(!this.view){this.view=new a(this.viewConfig)}return this.view}});Ext.ComponentMgr.registerType("rs-ext-treegridpanel",Rs.ext.grid.TreeGridPanel)})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GeneralselGridPanel=function(d){d=d||{};var a=d.progCode,c=d.progCondition;var b=d.store||d.ds||new Rs.ext.data.GeneralselStore({autoLoad:true,autoDestroy:true,progCode:a,progCondition:c});var e=d.columns||[];this.configColumns=e;delete d.columns;Ext.applyIf(d,{store:b,columns:e});Rs.ext.grid.GeneralselGridPanel.superclass.constructor.call(this,d);this.store.on("metachange",this.onStoreMeataChange,this)};Ext.extend(Rs.ext.grid.GeneralselGridPanel,Ext.grid.GridPanel,{onStoreMeataChange:function(o,p){var a=[],g=[],e,b,n;if(g=p?p.fields:undefined){if(this.selModel!=undefined&&this.selModel instanceof Ext.grid.CheckboxSelectionModel){a.push(this.selModel);if(this.rendered==true){this.getSelectionModel().init(this)}}if(this.configColumns.length==0){for(e=0,b=g.length;e<b;e++){for(var d in g){var h=g[d];if(h.seqNo==e){n=h;break}}var j={dataIndex:n.name,header:n.descCh||n.descEn||n.name,width:n.width,align:n.align,hidden:n.hidden,editable:false,hideable:true,sortable:true};a.push(j)}}else{a=Ext.combine(a,this.configColumns)}var m=new Ext.grid.ColumnModel(a);this.reconfigure(o,m)}}});Ext.ComponentMgr.registerType("rs-ext-generalselgridpanel",Rs.ext.grid.GeneralselGridPanel)})();Ext.ns("Rs.ext.grid");(function(){var a=function(b){b=b||{};var c=b.region;if(c=="west"||c=="east"){Ext.apply(b,{width:129,autoWidth:false,autoHeight:false})}else{Ext.apply(b,{autoWidth:false,autoHeight:true})}a.superclass.constructor.call(this,Ext.applyIf(b,{collapsible:true,collapsed:true,hideCollapseTool:true,collapseMode:"mini",split:true}));this.on("beforeexpand",function(){return this.configDisabled!=true},this);this.on("render",function(){if(this.configCollapsed===false&&this.loadFields===true){this.expand()}if(this.configDisabled==true){this.setDisabled(true)}},this,{scope:this,delay:10,single:true});this.on("resize",function(){if(this.ownerCt){this.ownerCt.doLayout()}},this,{delay:10})};Ext.extend(a,Ext.Panel,{bodyStyle:"padding:5px;",autoScroll:true,defaults:{border:false},animCollapse:false,configCollapsed:true,layout:"column",bbar:["->",{iconCls:"rs-action-query",text:"查询",handler:function(){this.ownerCt.ownerCt.doQuery()}},{xtype:"tbspacer"},{xtype:"tbspacer"},{iconCls:"rs-action-reset",text:"重置",handler:function(){this.ownerCt.ownerCt.doReset()}}],reconfigure:function(c,g){this.loadFields=false;this.generalselPanel=c;var b=[],h=[];for(var e=0,d=g.length;e<d;e++){if(!this.displayQueryField){var f=Ext.create(Ext.apply(g[e],{width:125,style:{marginRight:"4px",marginBottom:"2px"}}),"textfield");b.push({bodyStyle:"background:transparent;padding:3px 1px 1px 3px",width:132,items:f});h.push(f)}else{if(this.displayQueryField.indexOf(g[e]["dataIndex"])>-1){var f=Ext.create(Ext.apply(g[e],{width:125,style:{marginRight:"4px",marginBottom:"2px"}}),"textfield");b.push({bodyStyle:"background:transparent;padding:3px 1px 1px 3px",width:132,items:f});h.push(f)}}}this.removeFields();this.oldConditionFields=this.add(b);this.conditionFields=h;this.loadFields=true;if(this.configCollapsed===false&&this.rendered===true){this.expand()}this.fireEvent("resize")},removeFields:function(){var d=this.oldConditionFields||[];for(var c=0,b=d.length;c<b;c++){this.remove(d[c],true)}delete this.oldConditionFields},doQuery:function(){var b=this.conditionFields||[],h=[];for(var d=0,c=b.length;d<c;d++){var f=b[d],g=f.dataIndex,e=f.getValue();if(g!=undefined&&g.trim()!=""&&e!=undefined&&e.trim()!=""){h.push(g+" like '"+e+"%'")}}progCondtion=this.buildProgCondtion(h.join(" AND "));this.generalselPanel.query(progCondtion)},buildProgCondtion:function(b){return b},doReset:function(){var b=this.conditionFields||[];for(var d=0,c=b.length;d<c;d++){var e=b[d];e.reset()}},setDisabled:function(b){a.superclass.setDisabled.apply(this,arguments);this.configDisabled=b;if(b==true){(this.collapsed!=true)?this.collapse():null}else{}},onDestroy:function(){a.superclass.onDestroy.apply(this,arguments);this.removeFields()}});Rs.ext.grid.GeneralselPanel=function(c){c=c||{};var g=c.progCode,b=c.progCondition,i=c.displayQueryField;this.store=new Rs.ext.data.GeneralselStore({autoLoad:false,autoDestroy:true,progCode:g,progCondition:b});var h=c.gridConfig||{},f=h.columns||[];var k=c.pageSize;if(k!==false){k=Ext.isNumber(k)?k:20;this.pagingToolbar=new Rs.ext.grid.SliderPagingToolbar({pageSize:k,border:true,store:this.store,hasSlider:false,displayInfo:false});Ext.apply(c,{keys:[{key:36,fn:function(){var m=this.pagingToolbar.getPageData();if(m&&m.activePage>1){this.pagingToolbar.moveFirst()}},scope:this},{key:35,fn:function(){var m=this.pagingToolbar.getPageData();if(m&&m.activePage<m.pages){this.pagingToolbar.moveLast()}},scope:this},{key:33,fn:function(){var n=this.grid.getView().scroller.dom;if(n.scrollTop<=0){var m=this.pagingToolbar.getPageData();if(m&&m.activePage>1){this.pagingToolbar.movePrevious();n.scrollTop=n.scrollHeight-n.clientHeight}}},scope:this},{key:34,fn:function(){var n=this.grid.getView().scroller.dom;if(n.clientHeight+n.scrollTop>=n.scrollHeight){var m=this.pagingToolbar.getPageData();if(m&&m.activePage<m.pages){this.pagingToolbar.moveNext()}}},scope:this}]});Ext.apply(c,{bbar:this.pagingToolbar})}this.grid=new Rs.ext.grid.GeneralselGridPanel(Ext.apply(h,{store:this.store,columns:f,deferRowRender:false,enableHdMenu:false,loadMask:true,region:"center"}));var j=c.queryPanelConfig||{},e=c.queryPanelCollapsed,l=c.queryPanelPosition,d=c.queryPanelDisable;if(c.buildProgCondtion){buildProgCondtion=c.buildProgCondtion}if(c.queryPanel){this.queryPanel=c.queryPanel;this.queryPanel.bindStore(this.store,this.query,this);this.queryPanel.on("selectcondition",this.onQueryPanelChange,this);this.queryPanel.on("unselectcondition",this.onQueryPanelChange,this)}else{if(c.buildProgCondtion){this.queryPanel=new a(Ext.apply(j,{region:l||"north",configCollapsed:Ext.isBoolean(e)?e:true,configDisabled:Ext.isBoolean(d)?d:false,buildProgCondtion:buildProgCondtion}))}else{this.queryPanel=new a(Ext.apply(j,{region:l||"north",configCollapsed:Ext.isBoolean(e)?e:true,configDisabled:Ext.isBoolean(d)?d:false}))}this.buildinPanel=true}delete c.progCode;delete c.progCondition;delete c.displayQueryField;delete c.gridConfig;delete c.queryPanelCollapsed;delete c.queryPanelPosition;delete c.buildProgCondtion;Rs.ext.grid.GeneralselPanel.superclass.constructor.call(this,Ext.apply(c,{layout:"border"}));if(this.storeAutoLoad==true){this.store.load()}this.store.on("metachange",this.onStoreMeataChange,this);this.store.on("loadexception",this.onLoadException,this)};Ext.extend(Rs.ext.grid.GeneralselPanel,Ext.Panel,{storeAutoLoad:true,queryPanelDisable:false,initComponent:function(){Rs.ext.grid.GeneralselPanel.superclass.initComponent.apply(this,arguments);this.add(this.queryPanel);this.add(this.grid)},setQueryPanelDisable:function(b){if(this.rendered&&this.queryPanelDisable!=b){this.queryPanelDisable=b;this.queryPanel.setDisabled(b==true)}},onQueryPanelChange:function(){this.doLayout()},getStore:function(){return this.store},getGrid:function(){return this.grid},getPagingToolbar:function(){return this.pagingToolbar},onStoreMeataChange:function(d,h){var g=[],b,e,c,f,j;if(this.queryPanel&&(b=h?h.queryFields:undefined)){for(e=0,c=b.length;e<c;e++){f=b[e];j=f.descCh||f.descEn||f.name;g.push({dataIndex:f.name,allowBlank:f.allowBlank,emptyText:j,blankText:j+"不能为空"})}if(g.length>0){if(this.buildinPanel===true){this.queryPanel.reconfigure(this,g)}}}},onLoadException:function(d,c,b,f){},query:function(b,f,d){if(Ext.isFunction(f)){this.store.on("load",function(h,g,i){f.call(d||this,h,g,i)},this,{single:true})}var c=this.getPagingToolbar();if(c!=undefined){c.setStart(0)}if(!Ext.isEmpty(b,false)&&Ext.isString(b)){var e={};Ext.apply(e,{progCondition:b});this.store.load({params:e})}else{this.store.load()}},onDestroy:function(){Rs.ext.grid.GeneralselPanel.superclass.onDestroy.apply(this,arguments);if(this.store){this.store.un("metachange",this.onStoreMeataChange,this);this.store.un("load",this.onLoadSelectFirstRow,this);this.store.un("loadexception",this.onLoadException,this);this.store.destroy()}if(this.grid){this.grid.destroy()}if(this.pagingToolbar){this.pagingToolbar.destroy()}if(this.queryPanel){this.queryPanel.destroy()}},setProgCode:function(b,c){this.store.setProgCode(b,c)}});Ext.ComponentMgr.registerType("rs-ext-generalselpanel",Rs.ext.grid.GeneralselPanel)})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){Rs.ext.grid.BufferView.superclass.initTemplates.call(this);var a=this.templates;a.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');a.rowHolder.disableFormats=true;a.rowHolder.compile();a.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table>");a.rowBody.disableFormats=true;a.rowBody.compile()},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight},getVisibleRowCount:function(){var b=this.getCalculatedRowHeight(),a=this.scroller.dom.clientHeight;return(a<1)?0:Math.ceil(a/b)},getVisibleRows:function(){var a=this.getVisibleRowCount(),b=this.scroller.dom.scrollTop,c=(b===0?0:Math.floor(b/this.getCalculatedRowHeight())-1);return{first:Math.max(c,0),last:Math.min(c+a+2,this.ds.getCount()-1)}},doRender:function(g,k,u,a,s,A,l){var b=this.templates,f=b.cell,h=b.row,x=b.rowBody,n=s-1,t=this.getStyleRowHeight(),z=this.getVisibleRows(),d="width:"+this.getTotalWidth()+";height:"+t+"px;",D=[],w,E,v={},m={tstyle:d},q;for(var y=0,C=k.length;y<C;y++){q=k[y];w=[];var o=(y+a),e=o>=z.first&&o<=z.last;if(e){for(var B=0;B<s;B++){E=g[B];v.id=E.id;v.css=B===0?"x-grid3-cell-first ":(B==n?"x-grid3-cell-last ":"");v.attr=v.cellAttr="";v.value=E.renderer(q.data[E.name],v,q,o,B,u);v.style=E.style;if(v.value===undefined||v.value===""){v.value="&#160;"}if(q.dirty&&typeof q.modified[E.name]!=="undefined"){v.css+=" x-grid3-dirty-cell"}w[w.length]=f.apply(v)}}var F=[];if(A&&((o+1)%2===0)){F[0]="x-grid3-row-alt"}if(q.dirty){F[1]=" x-grid3-dirty-row"}m.cols=s;if(this.getRowClass){F[2]=this.getRowClass(q,o,m,u)}m.alt=F.join(" ");m.cells=w.join("");D[D.length]=!e?b.rowHolder.apply(m):(l?x.apply(m):h.apply(m))}return D.join("")},isRowRendered:function(a){var b=this.getRow(a);return b&&b.childNodes.length>0},syncScroll:function(){Rs.ext.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update()},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this)}this.renderTask.delay(this.scrollDelay)}else{this.doUpdate()}},onRemove:function(d,a,b,c){Rs.ext.grid.BufferView.superclass.onRemove.apply(this,arguments);if(c!==true){this.update()}},doUpdate:function(){if(this.getVisibleRowCount()>0){var f=this.grid,b=f.colModel,h=f.store,e=this.getColumnData(),a=this.getVisibleRows(),j;for(var d=a.first;d<=a.last;d++){if(!this.isRowRendered(d)&&(j=this.getRow(d))){var c=this.doRender(e,[h.getAt(d)],h,d,b.getColumnCount(),f.stripeRows,true);j.innerHTML=c}}this.clean()}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this)}this.cleanTask.delay(this.cleanDelay)},doClean:function(){if(this.getVisibleRowCount()>0){var b=this.getVisibleRows();b.first-=this.cacheSize;b.last+=this.cacheSize;var c=0,d=this.getRows();if(b.first<=0){c=b.last+1}for(var a=this.ds.getCount();c<a;c++){if((c<b.first||c>b.last)&&d[c].innerHTML){d[c].innerHTML=""}}}},removeTask:function(b){var a=this[b];if(a&&a.cancel){a.cancel();this[b]=null}},destroy:function(){this.removeTask("cleanTask");this.removeTask("renderTask");Rs.ext.grid.BufferView.superclass.destroy.call(this)},layout:function(){Rs.ext.grid.BufferView.superclass.layout.call(this);this.update()}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"确定",cancelText:"取消",commitChangesText:"您必须将修改内容保存或取消",errorText:"提示",defaults:{normalWidth:true},initComponent:function(){Rs.ext.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(a){this.grid=a;this.ownerCt=a;if(this.clicksToEdit===2){a.on("rowdblclick",this.onRowDblClick,this)}else{a.on("rowclick",this.onRowClick,this);if(Ext.isIE){a.on("rowdblclick",this.onRowDblClick,this)}}a.getStore().on("remove",function(){this.stopEditing(false)},this);a.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.onColumnMove,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});a.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});a.getView().on("refresh",this.stopEditing.createDelegate(this,[false]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout(true)},reinitFields:function(){this.stopEditing();this.initialized=false},isDirty:function(){var a;this.items.each(function(b){if(String(this.values[b.id])!==String(b.getValue())){a=true;return false}},this);return a},startEditing:function(k,p){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(k)){k=this.grid.getStore().indexOf(k)}if(this.fireEvent("beforeedit",this,k)!==false){this.editing=true;var e=this.grid,l=e.getView(),o=l.getRow(k),c=e.store.getAt(k);this.record=c;this.rowIndex=k;this.values={};if(!this.rendered){this.render(l.getEditorParent())}var m=Ext.fly(o).getWidth();this.setSize(m);if(!this.initialized){this.initFields()}var n=e.getColumnModel(),d=this.items.items,j,a;for(var b=0,h=n.getColumnCount();b<h;b++){a=this.preEditValue(c,n.getDataIndex(b));j=d[b];j.setValue(a);this.values[j.id]=Ext.isEmpty(a)?"":a}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(o).getXY())}else{this.el.setXY(Ext.fly(o).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(p!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(l){this.editing=false;if(!this.isVisible()){return}if(l===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,l===false);return}var g={},b=this.record,h=false,k=this.grid.colModel,e=this.items.items;for(var d=0,f=k.getColumnCount();d<f;d++){if(!k.isHidden(d)){var c=k.getDataIndex(d);if(!Ext.isEmpty(c)){var a=b.data[c],j=this.postEditValue(e[d].getValue(),a,b,c);if(String(a)!==String(j)){g[c]=j;h=true}}}}if(h&&this.fireEvent("validateedit",this,g,b,this.rowIndex)!==false){b.beginEdit();Ext.iterate(g,function(i,m){b.set(i,m)});b.endEdit();this.fireEvent("afteredit",this,g,b,this.rowIndex)}this.hide()},verifyLayout:function(e){if(this.el&&(this.isVisible()||e===true)){var g=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(g).getWidth(),Ext.isIE?Ext.fly(g).getHeight()+9:undefined);var c=this.grid.colModel,b=this.items.items;for(var d=0,a=c.getColumnCount();d<a;d++){if(!c.isHidden(d)){var f=0;if(d===(a-1)){f+=3}else{f+=1}b[d].show();aw=c.getColumnWidth(d)-f;b[d].setWidth(aw);b[d].width=aw}else{b[d].hide()}}this.doLayout();this.positionButtons()}},onColumnMove:function(d,e){if(!this.initialized){this.refreshFields()}else{var a=this.items.items;if(d>e){a[d].el.setX(a[e].el.getX());for(var c=e;c<d;c++){a[c].el.setX(a[c].el.getX()+a[d].el.getWidth())}}else{for(var c=d+1;c<=e;c++){a[c].el.setX(a[c].el.getX()-a[d].el.getWidth())}a[d].el.setX(a[e].el.getX()+a[e].el.getWidth())}if(d==0){if(a[0] instanceof Ext.form.DisplayField){a[0].el.removeClass("x-grid3-roweditor-uneditable-first-left");a[0].el.addClass("x-grid3-roweditor-uneditable-left")}}var b=this.items.items.splice(d,1);this.items.items.splice(e,0,b[0])}},slideHide:function(){this.hide()},initFields:function(){var b=this.grid.getColumnModel(),f=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var e=0,a=b.getColumnCount();e<a;e++){var g=b.getColumnAt(e);var d=g.getEditor?g.getEditor():null;if(!d){d=g.displayEditor||(e==0?new Ext.form.DisplayField({cls:"x-grid3-roweditor-uneditable-first x-grid3-roweditor-uneditable-first-left"}):new Ext.form.DisplayField({cls:"x-grid3-roweditor-uneditable x-grid3-roweditor-uneditable-left"}))}if(e==0){d.margins=f("0 1 2 1")}else{if(e==a-1){d.margins=f("0 0 2 1")}else{if(Ext.isIE){d.margins=f("0 0 2 0")}else{d.margins=f("0 1 2 0")}}}d.setWidth(b.getColumnWidth(e));d.column=g;if(d.ownerCt!==this){d.on("focus",this.ensureVisible,this);d.on("specialkey",this.onKey,this)}this.insert(e,d)}this.initialized=true},onKey:function(a,b){if(b.getKey()===b.ENTER){this.stopEditing(true);b.stopPropagation()}},onGridKey:function(c){if(c.getKey()===c.ENTER&&!this.isVisible()){var b=this.grid.getSelectionModel().getSelected();if(b){var a=this.grid.store.indexOf(b);this.startEditing(a);c.stopPropagation()}}},ensureVisible:function(a){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(a.column.id),true)}},onRowClick:function(b,d,c){if(this.clicksToEdit=="auto"){var a=this.lastClickIndex;this.lastClickIndex=d;if(a!=d&&!this.isVisible()){return}}this.startEditing(d,false);this.doFocus.defer(this.focusDelay,this,[c.getPoint()])},onRowDblClick:function(a,c,b){this.startEditing(c,false);this.doFocus.defer(this.focusDelay,this,[b.getPoint()])},onRender:function(){Rs.ext.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Rs.ext.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Rs.ext.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Rs.ext.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var e=this.grid,d=this.el.dom.clientHeight,b=e.getView(),a=b.scroller.dom.scrollLeft,f=this.btns.getWidth(),c=Math.min(e.getWidth(),e.getColumnModel().getTotalWidth());this.btns.el.shift({left:(c/2)-(f/2)+a,top:d-2,stopFx:true,duration:0.2})}},preEditValue:function(a,c){var b=a.data[c];return this.autoEncode&&typeof b==="string"?Ext.util.Format.htmlDecode(b):b},postEditValue:function(c,a,b,d){return this.autoEncode&&typeof c=="string"?Ext.util.Format.htmlEncode(c):c},doFocus:function(f){if(this.isVisible()){var d=0,b=this.grid.getColumnModel(),g;if(f){d=this.getTargetColumnIndex(f)}for(var e=d||0,a=b.getColumnCount();e<a;e++){g=b.getColumnAt(e);if(!g.hidden&&g.getEditor&&g.getEditor()){g.getEditor().focus();break}}}},getTargetColumnIndex:function(k){var a=this.grid,j=a.view,h=k.left,f=a.colModel.config,b=0,d=false;for(var e=f.length,g;g=f[b];b++){if(!g.hidden){if(Ext.fly(j.getHeaderCell(b)).getRegion().right>=h){d=b;break}}}return d},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var a=true;this.items.each(function(b){if(!b.isValid(true)){a=false;return false}});return a},bindHandler:function(){if(!this.bound){return false}var a=this.isValid();if(!a&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!a);this.fireEvent("validation",this,a)},lastVisibleColumn:function(){var a=this.items.getCount()-1,b;for(;a>=0;a--){b=this.items.items[a];if(!b.hidden){return b}}},showTooltip:function(f){var c=this.tooltip;if(!c){c=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var b=this.grid.getView(),e=parseInt(this.el.dom.style.top,10),a=b.scroller.dom.scrollTop,d=this.el.getHeight();if(e+d>=a){c.initTarget(this.lastVisibleColumn().getEl());if(!c.rendered){c.show();c.hide()}c.body.update(f);c.doAutoWidth(20);c.show()}else{if(c.rendered){c.hide()}}},getErrorText:function(){var a=["<ul>"];this.items.each(function(b){if(!b.isValid(true)){a.push("<li>",b.getActiveError(),"</li>")}});a.push("</ul>");return a}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Rs.ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.ColumnModel=Ext.extend(Ext.grid.ColumnModel,{getColumnHeader:function(a){var b=this.config[a].editor;if(b==null||b==undefined){return this.config[a].header}var c=this.config[a].header;return c+" <span class='rs-cell-editor'>&nbsp;&nbsp;&nbsp;&nbsp;</span>"}})})();Ext.ns("Rs.ext.grid");Rs.ext.grid.EditorGridViewPlugin=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.EditorGridViewPlugin,Ext.util.Observable,{init:function(b){var a=b.getView();Ext.apply(a,{initTemplates:function(){var e=a.templates||{},f,d,h=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',a.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}",'<img alt="" class="rs-cell-editor" src="',Ext.BLANK_IMAGE_URL,'" />','<img alt="" class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td>"),c=['<tr class="x-grid3-row-body-tr" style="{bodyStyle}">','<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">','<div class="x-grid3-row-body">{body}</div>',"</td>","</tr>"].join(""),g=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",a.enableRowBody?c:"","</tbody>","</table>"].join("");Ext.applyIf(e,{hcell:h,cell:a.cellTpl,body:a.bodyTpl,header:a.headerTpl,master:a.masterTpl,row:new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+g+"</div>"),rowInner:new Ext.Template(g)});for(d in e){f=e[d];if(f&&Ext.isFunction(f.compile)&&!f.compiled){f.disableFormats=true;f.compile()}}a.templates=e;a.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},render:function(){if(this.autoFill){var c=this.grid.ownerCt;if(c&&c.getLayout()){c.on("afterlayout",function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI();this.updateEditorPen()},updateEditorPen:function(){var f=a.cm.config;for(var e=0,d=f.length;e<d;e++){var g=f[e];if(g.editor){a.mainHd.select("td").item(e).addClass("rs-grid-editor")}}},onDataChange:function(){this.refresh(true);this.updateHeaderSortState();this.updateEditorPen();this.syncFocusEl(0)},onColumnMove:function(c,e,d){this.indexMap=null;this.refresh(true);this.updateEditorPen();this.restoreScroll(this.getScrollState());this.afterMove(d);this.grid.fireEvent("columnmove",e,d)}})}});(function(){Rs.ext.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.masterTpl){a.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")}this.templates=a;Rs.ext.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(a){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),g=e.child("div.x-grid3-locked"),c=g.child("div.x-grid3-header"),b=g.child("div.x-grid3-scroller"),f=e.child("div.x-grid3-viewport"),d=f.child("div.x-grid3-header"),a=f.child("div.x-grid3-scroller");if(this.grid.hideHeaders){c.setDisplayed(false);d.setDisplayed(false)}if(this.forceFit){a.setStyle("overflow-x","hidden")}Ext.apply(this,{el:e,mainWrap:f,mainHd:d,innerHd:d.dom.firstChild,scroller:a,mainBody:a.child("div.x-grid3-body"),focusEl:a.child("a"),resizeMarker:e.child("div.x-grid3-resize-marker"),resizeProxy:e.child("div.x-grid3-resize-proxy"),lockedWrap:g,lockedHd:c,lockedScroller:b,lockedBody:b.child("div.x-grid3-body"),lockedInnerHd:c.child("div.x-grid3-header-inner",true)});this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(c,a){var b=this.cm.getLockedCount();if(a<b){return this.getLockedRow(c).getElementsByTagName("td")[a]}return Rs.ext.grid.LockingGridView.superclass.getCell.call(this,c,a-b)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b){return this.lockedHd.dom.getElementsByTagName("td")[a]}return Rs.ext.grid.LockingGridView.superclass.getHeaderCell.call(this,a-b)},addRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).addClass(a)}Rs.ext.grid.LockingGridView.superclass.addRowClass.call(this,c,a)},removeRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).removeClass(a)}Rs.ext.grid.LockingGridView.superclass.removeRowClass.call(this,c,a)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Rs.ext.grid.LockingGridView.superclass.removeRow.call(this,a)},removeRows:function(c,b){var a=this.lockedBody.dom,d=c;for(;d<=b;d++){Ext.removeNode(a.childNodes[c])}Rs.ext.grid.LockingGridView.superclass.removeRows.call(this,c,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop;Rs.ext.grid.LockingGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(d,c){var a=this.sortClasses,e=this.lockedHd.select("td").removeClass(a),g=this.mainHd.select("td").removeClass(a),f=this.cm.getLockedCount(),b=a[c=="DESC"?1:0];if(d<f){e.item(d).addClass(b)}else{g.item(d-f).addClass(b)}},updateAllColumnWidths:function(){var g=this.getTotalWidth(),n=this.cm.getColumnCount(),b=this.getLockedWidth(),d=this.cm.getLockedCount(),k=[],h,e;this.updateLockedWidth();for(e=0;e<n;e++){k[e]=this.getColumnWidth(e);var f=this.getHeaderCell(e);f.style.width=k[e]}var a=this.getLockedRows(),m=this.getRows(),o,l,c;for(e=0,h=m.length;e<h;e++){o=a[e];o.style.width=b;if(o.firstChild){o.firstChild.style.width=b;l=o.firstChild.rows[0];for(c=0;c<d;c++){l.childNodes[c].style.width=k[c]}}o=m[e];o.style.width=g;if(o.firstChild){o.firstChild.style.width=g;l=o.firstChild.rows[0];for(c=d;c<n;c++){l.childNodes[c-d].style.width=k[c]}}}this.onAllColumnWidthsUpdated(k,g);this.syncHeaderHeight()},updateColumnWidth:function(d,a){var l=this.getColumnWidth(d),e=this.cm.getLockedCount(),k,b,j,m;this.updateLockedWidth();if(d<e){k=this.getLockedRows();b=this.getLockedWidth();j=d}else{k=this.getRows();b=this.getTotalWidth();j=d-e}var g=this.getHeaderCell(d);g.style.width=l;for(var f=0,h=k.length;f<h;f++){m=k[f];m.style.width=b;if(m.firstChild){m.firstChild.style.width=b;m.firstChild.rows[0].childNodes[j].style.width=l}}this.onColumnWidthUpdated(d,l,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(b,g){var d=this.cm.getLockedCount(),l,a,k,m,j=g?"none":"";this.updateLockedWidth();if(b<d){l=this.getLockedRows();a=this.getLockedWidth();k=b}else{l=this.getRows();a=this.getTotalWidth();k=b-d}var f=this.getHeaderCell(b);f.style.display=j;for(var e=0,h=l.length;e<h;e++){m=l[e];m.style.width=a;if(m.firstChild){m.firstChild.style.width=a;m.firstChild.rows[0].childNodes[k].style.display=j}}this.onColumnHiddenUpdated(b,g,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(g,l,t,a,s,x){var d=this.templates,f=d.cell,h=d.row,n=s-1,e="width:"+this.getTotalWidth()+";",b="width:"+this.getLockedWidth()+";",A=[],D=[],v,k,B,u={},m={},q;for(var w=0,z=l.length;w<z;w++){q=l[w];v=[];k=[];var o=(w+a);for(var y=0;y<s;y++){B=g[y];u.id=B.id;u.css=(y===0?"x-grid3-cell-first ":(y==n?"x-grid3-cell-last ":""))+(this.cm.config[y].cellCls?" "+this.cm.config[y].cellCls:"");u.attr=u.cellAttr="";u.value=B.renderer(q.data[B.name],u,q,o,y,t);u.style=B.style;if(Ext.isEmpty(u.value)){u.value="&#160;"}if(this.markDirty&&q.dirty&&Ext.isDefined(q.modified[B.name])){u.css+=" x-grid3-dirty-cell"}if(B.locked){k[k.length]=f.apply(u)}else{v[v.length]=f.apply(u)}}var C=[];if(x&&((o+1)%2===0)){C[0]="x-grid3-row-alt"}if(q.dirty){C[1]=" x-grid3-dirty-row"}m.cols=s;if(this.getRowClass){C[2]=this.getRowClass(q,o,m,t)}m.alt=C.join(" ");m.cells=v.join("");m.tstyle=e;A[A.length]=h.apply(m);m.cells=k.join("");m.tstyle=b;D[D.length]=h.apply(m)}return[A.join(""),D.join("")]},processRows:function(b,h){if(!this.ds||this.ds.getCount()<1){return}var f=this.getRows(),e=this.getLockedRows(),g,d;h=h||!this.grid.stripeRows;b=b||0;for(var c=0,a=f.length;c<a;++c){g=f[c];d=e[c];g.rowIndex=c;d.rowIndex=c;if(!h){g.className=g.className.replace(this.rowClsRe," ");d.className=d.className.replace(this.rowClsRe," ");if((c+1)%2===0){g.className+=" x-grid3-row-alt";d.className+=" x-grid3-row-alt"}}this.syncRowHeights(g,d)}if(b===0){Ext.fly(f[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(f[f.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)},syncRowHeights:function(f,e){if(this.syncHeights){var d=Ext.get(f),b=Ext.get(e),c=d.getHeight(),a=b.getHeight();if(c>a){b.setHeight(c)}else{if(a>c){d.setHeight(a)}}}},afterRender:function(){if(!this.ds||!this.cm){return}var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent("viewready",this.grid)},renderUI:function(){var b=this.templates,c=this.renderHeaders(),a=b.body.apply({rows:"&#160;"});return b.masterTpl.apply({body:a,header:c[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:a,lockedHeader:c[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(this.grid.enableColLock!==false){this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"})}if(a.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:a.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var d=this.grid;var h=d.getGridEl();var a=h.getSize(true);var b=a.width;if(!d.hideHeaders&&(b<20||a.height<20)){return}this.syncHeaderHeight();if(d.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(a.width,a.height);var f=this.mainHd.getHeight();var e=a.height-(f)}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=b){this.fitColumns(false,false);this.lastViewWidth=b}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(b,e)},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+"px"},renderHeaders:function(){var h=this.cm,f=this.templates,d=f.hcell,b=[],g=[],a={},e=h.getColumnCount(),j=e-1;for(var c=0;c<e;c++){a.id=h.getColumnId(c);a.value=h.getColumnHeader(c)||"";a.style=this.getColumnStyle(c,true);a.tooltip=this.getColumnTooltip(c);a.css=(c===0?"x-grid3-cell-first ":(c==j?"x-grid3-cell-last ":""))+(h.config[c].headerCls?" "+h.config[c].headerCls:"");if(h.config[c].align=="right"){a.istyle="padding-right:16px"}else{delete a.istyle}if(h.isLocked(c)){g[g.length]=d.apply(a)}else{b[b.length]=d.apply(a)}}return[f.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),f.header.apply({cells:g.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a){return null}var d=a.cell,b=a.row;return d?Ext.fly(d).getXY():[this.scroller.getX(),Ext.fly(b).getY()]},syncFocusEl:function(c,a,b){Rs.ext.grid.LockingGridView.superclass.syncFocusEl.call(this,c,a,a<this.cm.getLockedCount()?false:b)},ensureVisible:function(c,a,b){return Rs.ext.grid.LockingGridView.superclass.ensureVisible.call(this,c,a,a<this.cm.getLockedCount()?false:b)},insertRows:function(a,g,d,f){var c=a.getCount()-1;if(!f&&g===0&&d>=c){this.refresh()}else{if(!f){this.fireEvent("beforerowsinserted",this,g,d)}var b=this.renderRows(g,d),e=this.getRow(g);if(e){if(g===0){this.removeRowClass(0,this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",e,b[0]);e=this.getLockedRow(g);Ext.DomHelper.insertHtml("beforeBegin",e,b[1])}else{this.removeRowClass(c-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,b[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,b[1])}if(!f){this.fireEvent("rowsinserted",this,g,d);this.processRows(g)}else{if(g===0||g>=c){this.addRowClass(g,g===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(g)},getColumnStyle:function(a,c){var b=!c?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";b+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a)){b+="display:none;"}var d=this.cm.config[a].align;if(d){b+="text-align:"+d+";"}return b},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px"},getColumnData:function(){var d=[],a=this.cm,e=a.getColumnCount();for(var c=0;c<e;c++){var b=a.getDataIndex(c);d[c]={name:(!Ext.isDefined(b)?this.ds.fields.get(c).name:b),renderer:a.getRenderer(c),id:a.getColumnId(c),style:this.getColumnStyle(c),locked:a.isLocked(c)}}return d},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(c){var g=this.ds,r=this.cm.getColumnCount(),b=this.getColumnData(),l=r-1,a=["x-grid3-row"],k={tstyle:String.format("width: {0};",this.getTotalWidth())},j={tstyle:String.format("width: {0};",this.getLockedWidth())},f=[],e=[],o=this.templates.cell,n,h,m,d,q,p,s;if(Ext.isNumber(c)){n=c;c=g.getAt(n)}else{n=g.indexOf(c)}if(!c||n<0){return}for(s=0;s<r;s++){d=b[s];if(s==0){p="x-grid3-cell-first"}else{p=(s==l)?"x-grid3-cell-last ":""}q={id:d.id,style:d.style,css:p,attr:"",cellAttr:""};q.value=d.renderer.call(d.scope,c.data[d.name],q,c,n,s,g);if(Ext.isEmpty(q.value)){q.value=" "}if(this.markDirty&&c.dirty&&typeof c.modified[d.name]!="undefined"){q.css+=" x-grid3-dirty-cell"}if(d.locked){e[s]=o.apply(q)}else{f[s]=o.apply(q)}}h=this.getRow(n);h.className="";m=this.getLockedRow(n);m.className="";if(this.grid.stripeRows&&((n+1)%2===0)){a.push("x-grid3-row-alt")}if(this.getRowClass){k.cols=r;a.push(this.getRowClass(c,n,k,g))}this.fly(h).addClass(a).setStyle(k.tstyle);k.cells=f.join("");h.innerHTML=this.templates.rowInner.apply(k);this.fly(m).addClass(a).setStyle(j.tstyle);j.cells=e.join("");m.innerHTML=this.templates.rowInner.apply(j);m.rowIndex=n;this.syncRowHeights(h,m);this.fireEvent("rowupdated",this,n,c)},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un("columnlockchange",this.onColumnLock,this)}Rs.ext.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on("columnlockchange",this.onColumnLock,this)}},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(d){var b=this.hdCtxIndex,a=this.cm,e=d.getItemId(),c=a.getLockedCount();switch(e){case"lock":if(a.getColumnCount(true)<=c+1){this.onDenyColumnLock();return undefined}a.setLocked(b,true);if(c!=b){a.moveColumn(b,c);this.grid.fireEvent("columnmove",b,c)}break;case"unlock":if(c-1!=b){a.setLocked(b,false,true);a.moveColumn(b,c-1);this.grid.fireEvent("columnmove",b,c-1)}else{a.setLocked(b,false)}break;default:return Rs.ext.grid.LockingGridView.superclass.handleHdMenuClick.call(this,d)}return true},handleHdDown:function(g,d){Rs.ext.grid.LockingGridView.superclass.handleHdDown.call(this,g,d);if(this.grid.enableColLock!==false){if(Ext.fly(d).hasClass("x-grid3-hd-btn")){var f=this.findHeaderCell(d),c=this.getCellIndex(f),b=this.hmenu.items,a=this.cm;b.get("lock").setDisabled(a.isLocked(c));b.get("unlock").setDisabled(!a.isLocked(c))}}},syncHeaderHeight:function(){var d=Ext.fly(this.innerHd).child("tr",true),b=Ext.fly(this.lockedInnerHd).child("tr",true);d.style.height="auto";b.style.height="auto";var e=d.offsetHeight,c=b.offsetHeight,a=Math.max(c,e)+"px";d.style.height=a;b.style.height=a},updateLockedWidth:function(){var g=this.cm.getTotalLockedWidth(),a=this.cm.getTotalWidth()-g,c=this.grid.getGridEl().getSize(true),b=Ext.isBorderBox?0:this.lockedBorderWidth,d=Ext.isBorderBox?0:this.rowBorderWidth,e=(c.width-g-b-d)+"px",f=this.getScrollOffset();if(!this.grid.autoHeight){var h=(c.height-this.mainHd.getHeight())+"px";this.lockedScroller.dom.style.height=h;this.scroller.dom.style.height=h}this.lockedWrap.dom.style.width=(g+d)+"px";this.scroller.dom.style.width=e;this.mainWrap.dom.style.left=(g+b+d)+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=g+"px";this.lockedInnerHd.firstChild.firstChild.style.width=g+"px";this.innerHd.style.width=e;this.innerHd.firstChild.style.width=(a+d+f)+"px";this.innerHd.firstChild.firstChild.style.width=a+"px"}if(this.mainBody){this.lockedBody.dom.style.width=(g+d)+"px";this.mainBody.dom.style.width=(a+d)+"px"}}})})();(function(){Rs.ext.grid.LockingColumnModel=Ext.extend(Rs.ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].lockedColumn===true},setLocked:function(b,c,a){if(this.isLocked(b)==c){return}this.config[b].lockedColumn=c;if(!a){this.fireEvent("columnlockchange",this,b,c)}},getTotalLockedWidth:function(){var b=0;for(var c=0,a=this.config.length;c<a;c++){if(this.isLocked(c)&&!this.isHidden(c)){b+=this.getColumnWidth(c)}}return b},getLockedCount:function(){var a=this.config.length;for(var b=0;b<a;b++){if(!this.isLocked(b)){return b}}return a},moveColumn:function(d,c){var a=this.isLocked(d),b=this.isLocked(c);if(d<c&&a&&!b){this.setLocked(d,false,true)}else{if(d>c&&!a&&b){this.setLocked(d,true,true)}}Rs.ext.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}})})();Ext.namespace("Rs.ext.grid");(function(){Rs.ext.grid.PagingSelectPlugin=function(a){this.cfg=a;Ext.apply(this,a);this.addEvents("submit")};Ext.extend(Rs.ext.grid.PagingSelectPlugin,Ext.util.Observable,{init:function(a){this.grid=a},initWindow:function(c){var f=this.createStore(c);var g=this.createSelectModel(c);var h=this.createColumnModel(c,g);this.leftGrid=new Ext.grid.GridPanel({border:false,hideBorders:true,store:f,sm:g,stripeRows:true,colModel:h,clicksToEdit:1,bbar:new Rs.ext.grid.SliderPagingToolbar({pageSize:10,hasSlider:false,store:f,displayInfo:false})});var a=new Ext.data.JsonStore({fields:c.store.fields.keys});var d=this.createSelectModel(c);var e=this.createColumnModel(c,d);this.rightGrid=new Ext.grid.GridPanel({border:false,hideBorders:true,store:a,sm:d,stripeRows:true,colModel:e,clicksToEdit:1});this.buttonPanel=new Ext.Panel({layout:"vbox",layoutConfig:{align:"center",pack:"center"},defaults:{margins:"10 0 10 0"},frame:true,border:false,hideBorders:true,items:[new Ext.Button({tooltip:"添加",iconCls:"rs-action-goright",handler:this.doAppend,scope:this}),new Ext.Button({tooltip:"移除",iconCls:"rs-action-goleft",handler:this.doRemove,scope:this}),new Ext.Button({tooltip:"全部添加",iconCls:"rs-action-bacthgoright",handler:this.doAppendAll,scope:this}),new Ext.Button({tooltip:"全部移除",iconCls:"rs-action-bacthgoleft",handler:this.doRemoveAll,scope:this})]});var b={layout:"fit",closable:true,modal:true,resizable:true,border:false,hideBorders:true,width:800,height:600,items:[{layout:"column",items:[{columnWidth:0.5,layout:"fit",items:[this.leftGrid]},{padding:2,margins:3,items:[this.buttonPanel]},{columnWidth:0.5,layout:"fit",items:[this.rightGrid]}]}],buttonAlign:"center",buttons:[{xtype:"button",text:"确定",iconCls:"rs-action-ok",handler:this.doSubmit,scope:this},{xtype:"button",text:"取消",iconCls:"rs-action-cancel",handler:this.doCancel,scope:this}],listeners:{resize:this.doLayoutPanel,scope:this}};Rs.apply(b,this.cfg);this.win=new Ext.Window(b)},doLayoutPanel:function(d){var a=d.getInnerHeight()-2,b=d.getInnerWidth();this.leftGrid.setHeight(a);this.buttonPanel.setHeight(a);this.rightGrid.setHeight(a)},createStore:function(b){var a=this.createStoreConfig(b);return new Rs.ext.data.Store(a)},createStoreConfig:function(b){var a=b.getStore(),c=Rs.apply(c||{},a.baseParams);cfg={autoLoad:true,autoDestroy:true,url:a.url,fields:a.fields.keys,baseParams:c};if(a.sortInfo){Rs.apply(cfg,{sortInfo:a.sortInfo})}if(a.idProperty){Rs.apply(cfg,{idProperty:a.idProperty})}return cfg},createColumnModel:function(c,d){var a=c.getColumnModel();var b=[d];Ext.each(a.config,function(g,f,e){if(!(g instanceof Ext.grid.AbstractSelectionModel||g instanceof Ext.grid.ActionColumn)){b.push(Rs.apply({},g))}},this);return new Ext.grid.ColumnModel(b)},createSelectModel:function(a){var b=a.getSelectionModel();if(b instanceof Ext.grid.CheckboxSelectionModel){b=new Ext.grid.CheckboxSelectionModel()}else{b=new Rs.ext.grid.CheckboxCellSelectionModel({})}return b},doAppend:function(){var d=this.leftGrid.getSelectionModel(),b=d.getSelections(),a=this.rightGrid.getStore();var c=[];Ext.each(b,function(e,g,f){if(a.getRange().indexOf(e)==-1){c.push(e)}},this);if(!Ext.isEmpty(c)){this.rightGrid.getStore().add(c)}},doRemove:function(){var a=this.rightGrid.getSelectionModel().getSelections();if(!Ext.isEmpty(a)){this.rightGrid.getStore().remove(a)}},doAppendAll:function(){this.leftGrid.getSelectionModel().selectAll();this.doAppend()},doRemoveAll:function(){this.rightGrid.getStore().removeAll()},doSubmit:function(){this.fireEvent("submit",this.plugin,this.win,this.rightGrid.getStore().getRange(),this)},doCancel:function(){this.win.close()},getLeftGrid:function(){return this.leftGrid},getRightGrid:function(){return this.rightGrid},getPluginWindow:function(){this.initWindow(this.grid);return this.win}})})();Ext.ns("Rs.ext.form");(function(){var a=function(){a.superclass.constructor.apply(this,arguments)};Ext.extend(a,Ext.form.Action.Load,{run:function(){var e=this.options,d=e.url||this.form.url||this.form.el.dom.action;Rs.Service.call({url:d,method:"load",scope:this,accept:"html",params:this.getParams(),success:this.success,failure:this.failure,timeout:(e.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined},this)},getParams:function(){var d=this.form.baseParams;var e=this.options.params;if(e){if(typeof e=="object"){e=Rs.urlEncode(Rs.applyIf(e,d))}else{if(typeof e=="string"&&d){e+="&"+Rs.urlEncode(d)}}}else{if(d){e=Rs.urlEncode(d)}}return e}});var b=function(){b.superclass.constructor.apply(this,arguments)};Ext.extend(b,Ext.form.Action.Submit,{run:function(){var h=this.options;if(h.clientValidation===false||this.form.isValid()){if(h.submitEmptyText===false){var d=this.form.items,g=[],e=function(i){if(i.el.getValue()==i.emptyText){g.push(i);i.el.dom.value=""}if(i.isComposite&&i.rendered){i.items.each(e)}};d.each(e)}var f=h.url||this.form.url||this.form.el.dom.action;Rs.Service.call({form:this.form.el.dom,url:f,accept:"html",method:h.method,params:this.getParams(),success:this.success,failure:this.failure,scope:this,timeout:(h.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined,isUpload:this.form.fileUpload});if(h.submitEmptyText===false){Ext.each(g,function(i){if(i.applyEmptyText){i.applyEmptyText()}})}}else{if(h.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},getParams:function(){var d=this.form.baseParams;var e=this.options.params;if(e){if(typeof e=="object"){e=Rs.urlEncode(Rs.applyIf(e,d))}else{if(typeof e=="string"&&d){e+="&"+Rs.urlEncode(d)}}}else{if(d){e=Rs.urlEncode(d)}}return e}});var c={load:a,submit:b};Rs.ext.form.BasicForm=function(){Rs.ext.form.BasicForm.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.BasicForm,Ext.form.BasicForm,{loadMethod:"load",submitMethod:"submit",waitTitle:"请稍等...",doAction:function(e,d){if(Ext.isString(e)){e=new c[e](this,d)}if(this.fireEvent("beforeaction",this,e)!==false){this.beforeAction(e);e.run.defer(100,e)}return this},submit:function(e){e=e||{};Ext.apply(e,{method:this.submitMethod});if(this.standardSubmit){var d=e.clientValidation===false||this.isValid();if(d){var f=this.el.dom;if(this.url&&Ext.isEmpty(f.action)){f.action=this.url}f.submit()}return d}this.doAction("submit",e);return this},load:function(d){Ext.apply(d,{method:this.loadMethod});this.doAction("load",d);return this}})})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.FormPanel=function(){Rs.ext.form.FormPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.FormPanel,Ext.form.FormPanel,{loadMethod:"load",submitMethod:"submit",createForm:function(){var a=Ext.applyIf({listeners:{}},this.initialConfig);return new Rs.ext.form.BasicForm(null,a)}});Ext.reg("rs-ext-formpanel",Rs.ext.form.FormPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.KindEditorPanel=function(b){if(!b.uploadJson&&b.upload){var a=b.upload;b.uploadJson=a.url+"?Rs-method="+a.method+"&Rs-accept=html&fileDir="+a.fileDir;delete b.upload}Ext.apply(this,b);Rs.ext.form.KindEditorPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.KindEditorPanel,Ext.Panel,{editoritems:["source","|","undo","redo","|","print","rstemplate","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertVideo","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],resizeType:2,uploadJson:"",upload:{},height:500,width:"90%",editorConfig:{},htmlEditor:{},onRender:function(d,b){Rs.ext.form.KindEditorPanel.superclass.onRender.apply(this,arguments);var c=KindEditor,e=Ext.getDom(d.dom),a=e.childNodes.length,f;function g(h){if(Ext.getDom(h).childNodes.length>0){return g(h.childNodes[0])}else{return h}}if(a){f=g(d.dom)}Rs.apply(this.editorConfig||{},{items:this.editoritems,uploadJson:this.uploadJson,height:this.height,filterMode:false,width:this.width,resizeType:this.resizeType});htmlEditor=c.create(f,this.editorConfig)},setValue:function(a){this.getEditor().html(a)},getValue:function(){return htmlEditor.html()},clearValue:function(){htmlEditor.html("")},getEditor:function(){return htmlEditor}});Ext.reg("kindeditor",Rs.ext.form.KindEditorPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.SimpleFileUploadPanel=function(a){Ext.apply(this,a);this.attachmentIdTextField=new Ext.form.TextField({dataIndex:"attachmentIdTextField",hidden:true,value:-1});this.gp=new Ext.grid.GridPanel({stripeRows:true,autoHeight:true,border:false,hideHeaders:true,store:new Ext.data.Store({fields:["attachmentId","attachmentIndex","id","name","type","size","state","percent"]}),columns:[{header:"附件编码",width:10,hidden:true,dataIndex:"attachmentId",menuDisabled:true},{header:"附件索引",width:10,hidden:true,dataIndex:"attachmentIndex",menuDisabled:true},{header:"文件名",width:190,sortable:true,dataIndex:"name",menuDisabled:true},{header:"类型",width:50,sortable:true,dataIndex:"type",menuDisabled:true},{header:"大小",width:80,sortable:true,dataIndex:"size",menuDisabled:true,renderer:this.formatFileSize},{header:"进度",width:150,sortable:true,dataIndex:"percent",menuDisabled:true,renderer:this.formatProgressBar,scope:this},{header:"状态",width:70,sortable:true,dataIndex:"state",menuDisabled:true,renderer:this.formatFileState,scope:this},{header:"&nbsp;",width:200,dataIndex:"id",menuDisabled:true,renderer:this.formatDelBtn}]});this.setting={upload_url:this.uploadUrl,flash_url:this.flashUrl,file_size_limit:this.fileSize||(1024*50),file_post_name:this.filePostName,file_types:this.fileTypes||"*.*",file_types_description:"All Files",file_upload_limit:"0",post_params:this.postParams,use_query_string:true,debug:false,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,custom_settings:{scope_handler:this},file_queued_handler:this.onFileQueued,swfupload_loaded_handler:function(){},file_dialog_start_handler:function(){},file_dialog_complete_handler:this.onDiaogComplete,upload_start_handler:this.onUploadStart,upload_success_handler:this.onUploadSuccess,swfupload_loaded_handler:function(){},upload_progress_handler:this.uploadProgress,upload_complete_handler:this.onUploadComplete,upload_error_handler:this.onUploadError,file_queue_error_handler:this.onFileError};this.uppanel=new Ext.Panel({hidden:true,autoHeight:true,items:[this.attachmentIdTextField,this.gp],border:false});Ext.apply(this.listeners||{},{afterrender:function(){var d=this.getTopToolbar().get(0).el.child("em");var c=Ext.id();d.setStyle({position:"relative",display:"block","z-index":1});d.createChild({tag:"div",id:c});this.swfupload=new SWFUpload(Ext.apply(this.setting,{button_width:d.getWidth(),button_height:d.getHeight(),button_placeholder_id:c}));this.swfupload.uploadStopped=false;Ext.get(this.swfupload.movieName).setStyle({position:"absolute",top:"0px",left:"-2px","z-index":2})},scope:this,delay:100});this.addBtn=new Ext.Button({text:"添加文件",iconCls:"rs-action-addfile"}),this.uploadBtn=new Ext.Button({text:"上传文件",iconCls:"rs-action-uploadfile",handler:this.startUpload,scope:this});this.stopBtn=new Ext.Button({text:"停止上传",iconCls:"rs-action-stopfile",handler:this.stopUpload,scope:this});this.deleteBtn=new Ext.Button({text:"删除所有",iconCls:"rs-action-cleanfile",handler:this.deleteAll,scope:this});var b=[this.addBtn,"-"];if(this.enableFile){b.push(this.uploadBtn);b.push("-");b.push(this.stopBtn);b.push("-")}b.push(this.deleteBtn);Rs.ext.form.SimpleFileUploadPanel.superclass.constructor.call(this,{border:false,tbar:new Ext.Toolbar({hideBorders:true,style:"background-color:#FFFFFF; background-image:url();",items:[b]}),layout:"fit",items:[this.uppanel]});this.addEvents("diaogcomplete","uploadsuccess","deletefile")};Ext.extend(Rs.ext.form.SimpleFileUploadPanel,Ext.Panel,{flashUrl:"/com/rsc/rs/pub/rsclient2/rs/ext/resources/swfupload.swf",enableFile:true,width:600,fieldLabel:null,fileSize:1024*50,uploadUrl:null,fileTypes:"*.*",postParams:{},toggleBtn:function(a){this.addBtn.setDisabled(a);if(this.uploadBtn){this.uploadBtn.setDisabled(a)}if(this.stopBtn){this.stopBtn.setDisabled(!a)}this.deleteBtn.setDisabled(a);this.gp.getColumnModel().setHidden(6,a)},onUploadStart:function(b){var a=this.settings.post_params;Ext.apply(a,{fileName:encodeURIComponent(b.name),attachmentId:this.customSettings.scope_handler.attachmentIdTextField.getValue(),uploadType:"simplePanel"});this.setPostParams(a)},startUpload:function(){if(this.swfupload){if(this.swfupload.getStats().files_queued>0){this.swfupload.uploadStopped=false;this.toggleBtn(true);this.swfupload.startUpload()}}},formatFileSize:function(c,b,a){return Ext.util.Format.fileSize(c)},formatFileState:function(a){switch(a){case -1:return"未上传";break;case -2:return"正在上传";break;case -3:return'<div style="color:red;">上传失败</div>';break;case -4:return"上传成功";break;case -5:return"取消上传";break;default:return a}},formatProgressBar:function(a){var b=this.getTplStr(a);return b},getTplStr:function(a){var b="#6593CF";var c="#7FA9E4";return String.format('<div><div style="border:1px solid {0};height:10px;width:{1}px;margin:4px 0px 1px 0px;float:left;"><div style="float:left;background:{2};width:{3}%;height:10px;"><div></div></div></div><div style="text-align:center;float:right;width:40px;margin:3px 0px 1px 0px;height:10px;font-size:12px;">{3}%</div></div>',c,(90),b,a)},onUploadComplete:function(c){var d=this.customSettings.scope_handler;if(c.filestatus==-4){var e=d.gp.store;for(var b=0;b<e.getCount();b++){var a=e.getAt(b);if(a.get("id")==c.id){a.set("percent",100);if(a.get("state")!=-3){a.set("state",c.filestatus)}a.commit()}}}if(this.getStats().files_queued>0&&this.uploadStopped==false){this.startUpload()}else{d.toggleBtn(false);d.linkBtnEvent()}},onFileQueued:function(a){var b=this.customSettings.scope_handler;var c=new Ext.data.Record({id:a.id,name:a.name,size:a.size,type:a.type,state:a.filestatus,percent:0});b.gp.getStore().add(c)},onUploadSuccess:function(c,a){var d=this.customSettings.scope_handler;var e=d.gp.store;if(Ext.util.JSON.decode(a).success){for(var b=0;b<e.getCount();b++){var f=e.getAt(b);if(f.get("id")==c.id){f.set("state",c.filestatus);f.set("attachmentId",Ext.util.JSON.decode(a).attachmentId);f.set("attachmentIndex",Ext.util.JSON.decode(a).attachmentIndex);d.attachmentIdTextField.setValue(Ext.util.JSON.decode(a).attachmentId);f.commit()}}}else{for(var b=0;b<e.getCount();b++){var f=e.getAt(b);if(f.get("id")==c.id){f.set("percent",0);f.set("state",-3);f.commit()}}}d.linkBtnEvent();d.fireEvent("uploadsuccess",d,Ext.util.JSON.decode(a),c)},uploadProgress:function(c,h,g){var e=this.customSettings.scope_handler;var d=Math.ceil((h/g)*100);d=d==100?99:d;var f=e.gp.store;for(var b=0;b<f.getCount();b++){var a=f.getAt(b);if(a.get("id")==c.id){a.set("percent",d);a.set("state",c.filestatus);a.commit()}}},onUploadError:function(b,f,d){var c=this.customSettings.scope_handler;c.linkBtnEvent();var e=c.gp.store;for(var a=0;a<e.getCount();a++){var g=e.getAt(a);if(g.get("id")==b.id){g.set("percent",0);g.set("state",b.filestatus);g.commit()}}},onFileError:function(a,c){switch(c){case -100:b("待上传文件列表数量超限，不能选择！");break;case -110:b("文件太大，不能选择！");break;case -120:b("该文件大小为0，不能选择！");break;case -130:b("该文件类型不可以上传！");break}function b(d){Ext.Msg.show({title:"提示",msg:d,width:280,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK})}},onDiaogComplete:function(){var a=this.customSettings.scope_handler;a.linkBtnEvent();a.uppanel.show();a.fireEvent("diaogcomplete",a)},stopUpload:function(){if(this.swfupload){this.swfupload.uploadStopped=true;this.swfupload.stopUpload()}var a=this.customSettings.scope_handler;a.fireEvent("stopupload",a)},deleteAll:function(){var d=this.gp.store;for(var b=0;b<d.getCount();b++){var a=d.getAt(b);var c=a.get("id");this.deleteFile(a.get("attachmentId"),a.get("attachmentIndex"),a.get("state"));this.swfupload.cancelUpload(c,false)}d.removeAll();this.swfupload.uploadStopped=false;this.fireEvent("removeall",this);this.uppanel.hide()},formatDelBtn:function(a){return"<a href='#' id='"+a+"'  style='color:red' class='link' ext:qtip='移除该文件'>移除</a>"},linkBtnEvent:function(){Ext.select("a.link",false,this.gp.el.dom).on("click",function(f,c){var b=this.gp.store;for(var a=0;a<b.getCount();a++){var d=b.getAt(a);if(d.get("id")==c.id){b.remove(d);this.deleteFile(d.get("attachmentId"),d.get("attachmentIndex"),d.get("state"))}}this.swfupload.cancelUpload(c.id,false)},this)},deleteFile:function(b,c,a){if(a!=-4){return}Rs.Service.call({url:"/rsc/rsclient/attachment",method:"deleteFile",params:{attachmentId:b,attachmentIndex:c}},function(d){this.fireEvent("deletefile",this,d)},this)}});Ext.reg("rs-ext-simplefileuploadpanel",Rs.ext.form.SimpleFileUploadPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.DateField=function(a){a=a||{};Rs.ext.form.DateField.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.DateField,Ext.form.DateField,{setValue:function(a){var a=Rs.ext.form.DateField.superclass.setValue.apply(this,arguments);return a},getValue:function(){return Ext.form.DateField.superclass.getValue.apply(this,arguments)||""},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});var a=this.parseDate(this.getValue())||"";this.menu.picker.setValue(a||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on")}});Ext.ComponentMgr.registerType("rs-ext-datefield",Rs.ext.form.DateField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.PeriodField=function(e){Rs.ext.form.PeriodField.superclass.constructor.call(this,Ext.apply({},e||{}))};Ext.extend(Rs.ext.form.PeriodField,Ext.form.DateField,{format:"Y-m",altFormats:"m/Y|m-Y|mY|Ym|Y-m|Y.m|m.Y|m月Y年|Y年m月",triggerClass:"x-form-date-trigger",parseDate:function(k){if(!k||Ext.isDate(k)){return k}var f=this.safeParse(k,this.format),g=this.altFormats,j=this.altFormatsArray;if(!f&&g){j=j||g.split("|");for(var h=0,e=j.length;h<e&&!f;h++){if(j[h].charAt(0)!=this.format.charAt(0)){continue}f=this.safeParse(k,j[h])}}return f},setValue:function(e){this.value=e;Rs.ext.form.PeriodField.superclass.setValue.call(this,e)},getValue:function(){return this.value},menuListeners:{select:function(e,f){this.setValue(f.format(this.format))},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var e=this.menuListeners;this.menu.un("select",e.select,this);this.menu.un("show",e.show,this);this.menu.un("hide",e.hide,this)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new d()}Ext.apply(this.menu.picker,{});this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.show(this.el,"tl-bl?")}});var d=function(f){d.superclass.constructor.call(this,f);this.plain=true;var e=new a(f);this.add(e);this.picker=e.picker;this.relayEvents(e,["select"])};Ext.extend(d,Ext.menu.Menu,{cls:"x-date-menu"});var c=function(f,e){c.superclass.constructor.call(this,e);this.component=f};Ext.extend(c,Ext.menu.BaseItem,{canActivate:true,onRender:function(f,e){this.component.render(f);this.el=this.component.getEl()},activate:function(){if(this.disabled){return false}this.component.focus();this.fireEvent("activate",this);return true},deactivate:function(){this.fireEvent("deactivate",this)},disable:function(){this.component.disable();c.superclass.disable.call(this)},enable:function(){this.component.enable();c.superclass.enable.call(this)}});var a=function(e){a.superclass.constructor.call(this,new b(e),e);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(f){f.getEl().swallowEvent("click");f.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(a,c,{onSelect:function(f,e){this.fireEvent("select",this,e,f);f.hideMonthPicker()}});var b=Ext.extend(Ext.Component,{format:"M-y",okText:"当前年月",cancelText:"取消",constrainToViewport:true,monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],startDay:0,value:0,noPastYears:false,initComponent:function(){b.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime():new Date().clearTime();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}},focus:function(){if(this.el){this.update(this.activeDate)}},onRender:function(g,f){var e=['<div style="width: 200px; height:175px;"></div>'];e[e.length]='<div class="x-date-mp"></div>';var h=document.createElement("div");h.className="x-date-picker";h.innerHTML=e.join("");g.dom.insertBefore(h,f);this.el=Ext.get(h);this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.el.unselectable();this.showMonthPicker();if(Ext.isIE){this.el.repaint()}this.update(this.value)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var e=['<table border="0" cellspacing="0">'];for(var f=0;f<6;f++){e.push("<tr>",f==0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next x-date-mp-sep"></a></td>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year  x-date-mp-sep"><a href="#"></a></td>','<td class="x-date-mp-month"><a href="#">',this.monthNames[f].substr(0,3),"</a></td>",'<td class="x-date-mp-month"><a href="#">',this.monthNames[f+6].substr(0,3),"</a></td></tr>")}e.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");this.monthPicker.update(e.join(""));this.monthPicker.on("click",this.onMonthDblClick,this);this.monthPicker.on("dblclick",this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(g,h,j){j+=1;if((j%2)==0){g.dom.xmonth=5+Math.round(j*0.5)}else{g.dom.xmonth=Math.round((j-1)*0.5)}})}},showMonthPicker:function(){this.createMonthPicker();var e=this.el.getSize();this.monthPicker.setSize(e);this.monthPicker.child("table").setSize(e);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.show()},updateMPYear:function(k){if(this.noPastYears){var h=new Date().getFullYear();if(k<(h+4)){k=h+4}}this.mpyear=k;var g=this.mpYears.elements;for(var f=1;f<=10;f++){var j=g[f-1],e;if((f%2)==0){e=k+Math.round(f*0.5);j.firstChild.innerHTML=e;j.xyear=e}else{e=k-(5-Math.round(f*0.5));j.firstChild.innerHTML=e;j.xyear=e}this.mpYears.item(f-1)[e==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")}},updateMPMonth:function(e){this.mpMonths.each(function(f,g,h){f[f.dom.xmonth==e?"addClass":"removeClass"]("x-date-mp-sel")})},selectMPMonth:function(e){},onMonthClick:function(i,g){i.stopEvent();var h=new Ext.Element(g),f;if(h.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(h.is("button.x-date-mp-ok")){this.update(new Date().clearTime());this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelMonth=f.dom.xmonth}else{if(f=h.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelYear=f.dom.xyear}else{if(h.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(h.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(i,g){i.stopEvent();var h=new Ext.Element(g),f;if(h.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(h.is("button.x-date-mp-ok")){this.activeDate=new Date().clearTime();this.value=this.activeDate;this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.update(this.activeDate||this.value);this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelMonth=f.dom.xmonth;this.update(new Date(this.mpSelYear,f.dom.xmonth,(this.activeDate||this.value).getDate()));this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelYear=f.dom.xyear}else{if(h.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(h.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},hideMonthPicker:function(e){Ext.menu.MenuMgr.hideAll()},showPrevMonth:function(f){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(f){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},update:function(g){this.activeDate=g;this.value=g;if(!this.internalRender){var e=this.el.dom.firstChild;var f=e.offsetWidth;this.el.setWidth(f+this.el.getBorderWidth("lr"));Ext.fly(e).setWidth(f);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){e.rows[0].cells[1].style.width=(f-(e.rows[0].cells[0].offsetWidth+e.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[g])}}}})})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.GridLoaderField=function(d){d=d||{};var a=d.progCode,c=d.progCondition,b=d.queryPanelConfig,f=d.gridConfig,e=d.buildProgCondtion;this.columns=d.columns||[];delete d.columns;Rs.ext.form.GridLoaderField.superclass.constructor.call(this,Ext.apply(d,{enableKeyEvents:true,validationEvent:"blur"}));this.generalselPanel=this.initGeneralselPanel({progCode:a,progCondition:c,queryPanelConfig:b,gridConfig:f,buildProgCondtion:e});this.addEvents("beforeexpand","expand","collapse","beforeselect","select","change","passed","unpassed")};Ext.extend(Rs.ext.form.GridLoaderField,Ext.form.TriggerField,{queryDelay:200,gridWidth:410,minGridWidth:410,maxGridWidth:800,gridHeight:320,minGridHeight:320,maxGridHeight:600,errorValueText:"错误数据",maskRe:/[^,;'"\\]/,keyNavConfig:{up:function(){if(this.isExpanded()){this.focusPrev()}},down:function(){if(!this.isExpanded()){this.onTriggerClick()}else{this.focusNext()}},enter:function(b){b.stopPropagation();var a=this.generalselPanel.getGrid();if(this.isExpanded()){this.onSelect()}},esc:function(){if(this.isExpanded()){this.collapse()}},home:function(c){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.moveFirst()}},end:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveLast()}},pageUp:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.movePrevious()}},pageDown:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveNext()}},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){var d=Ext.KeyNav.prototype.doRelay.apply(this,arguments);if(!Ext.isIE&&Ext.EventManager.useKeydown){this.scope.fireKey(c)}return d}return true},forceKeyDown:true,defaultEventAction:"stopEvent"},fireKey:function(a){if(!this.isExpanded()){Rs.ext.form.GridLoaderField.superclass.fireKey.call(this,a)}},fieldKeyNavConfig:{},initGeneralselPanel:function(b){b=b||{};b=Ext.apply(b,{storeAutoLoad:false,queryPanelConfig:Ext.applyIf(b.queryPanelConfig||{},{border:true,margins:"1 1 0 1"}),queryPanelCollapsed:false,queryPanelDisable:this.readOnly==true,gridConfig:Ext.applyIf(b.gridConfig||{},{columns:this.columns,border:true,margins:"0 1 0 1"}),buildProgCondtion:b.buildProgCondtion,width:this.gridWidth,height:this.gridHeight,border:false});var a=new Rs.ext.grid.GeneralselPanel(b);return a},initEvents:function(){Rs.ext.form.GridLoaderField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,Ext.apply(this.keyNavConfig,{scope:this,forceKeyDown:true}));this.mon(this.el,"keyup",this.filterQuery,this);this.on("specialkey",this.tabKeyCollapse,this);this.quikTask=new Ext.util.DelayedTask(this.quickAhead,this)},initLayer:function(){this.view=new Ext.Layer({constrain:false,shadow:"sides",cls:" x-combo-list "});this.view.swallowEvent("mousewheel");this.view.swallowEvent("mousedown");this.resizer=new Ext.Resizable(this.view,{pinned:true,handles:"se",minWidth:this.minGridWidth,maxWidth:this.maxGridWidth,minHeight:this.minGridHeight,maxHeight:this.maxGridHeight});this.generalselPanel.render(this.view);this.initLayerEvents()},initLayerEvents:function(){this.fieldKeyNav=new Ext.KeyNav(this.generalselPanel.el,Ext.apply(this.fieldKeyNavConfig,{scope:this,forceKeyDown:true}));this.resizer.on("resize",function(d,b,c){this.generalselPanel.setWidth(b-2);this.generalselPanel.setHeight(c-2)},this);var a=this.generalselPanel.getGrid();if(a){a.on("rowclick",this.rowClick,this,{delay:20,scope:this})}},filterQuery:function(a){if(!a.isSpecialKey()||a.getKey()==a.BACKSPACE||a.getKey()==a.DELETE){if(a.getKey()==a.BACKSPACE||a.getKey()==a.DELETE){this.setValue(this.getRawValue())}this.quikTask.delay(this.queryDelay);this.on("blur",this.clearQueryTask,this)}},clearQueryTask:function(){this.un("blur",this.clearQueryTask);this.quikTask.cancel()},quickAhead:function(){if(!this.isExpanded()){this.expand()}this.doQuery()},rowClick:function(b){var d;if(b&&(d=b.getSelectionModel())){this.rowSelect(d.getSelections());var a=b.getStore(),c=[];a.each(function(e){if(d.isSelected(e)==false){c.push(e)}},this);this.rowDeSelect(c)}},rowSelect:function(a){this.onSelect()},rowDeSelect:function(a){},doQuery:function(){var c=this.getDisplayField(),b=this.getValueField(),d,a;if(this.readOnly==true){d=this.getValue();if(!Ext.isEmpty(b,false)&&!Ext.isEmpty(d,false)){a=b+" = '"+d+"'"}else{a="1 <> 1"}}else{d=this.getRawValue();if(!Ext.isEmpty(c,false)&&!Ext.isEmpty(d,false)){a=c+" like '"+d+"%'"}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(f,e,g){this.fireEvent("query",this,e,a)},this)}},buildProgCondtion:function(a){return a},isExpanded:function(){return this.view&&this.view.isVisible()},expand:function(){if(this.view==undefined){this.initLayer()}if(this.isExpanded()){return}if(this.fireEvent("beforeexpand",this)!==false){this.view.alignTo(this.wrap,"tl-bl?");this.view.show();Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this);this.fireEvent("expand",this)}},beforeCollapse:Ext.emptyFn,collapse:function(){if(!this.isExpanded()){return}this.beforeCollapse();this.view.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this);this.onCollapse()},onCollapse:Ext.emptyFn,collapseIf:function(a){if(a&&!a.within(this.wrap)&&!a.within(this.view)){this.collapse()}},tabKeyCollapse:function(b,a){if(a&&a.getKey()==a.TAB){this.collapse()}},validateBlur:function(){return !this.view||!this.view.isVisible()},onTriggerClick:function(){if(!this.isExpanded()&&!this.disabled){this.expand();this.doQuery()}else{this.collapse()}},focusFirst:function(){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),c=b.getSelectionModel();if(a.getCount()>0){c.selectFirstRow()}this.focus()},focusLast:function(){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),c=b.getSelectionModel();if(a.getCount()>0){c.selectLastRow()}this.focus()},focusPrev:function(){var a=this.generalselPanel.getGrid(),b=a.getSelectionModel();if(b.hasSelection()){b.selectPrevious()}else{b.selectFirstRow()}this.focus()},focusNext:function(){var a=this.generalselPanel.getGrid(),b=a.getSelectionModel();if(b.hasSelection()){b.selectNext()}else{b.selectFirstRow()}this.focus()},onSelect:function(){if(this.readOnly){this.collapse();return}var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),e=b.getSelectionModel();record=e.getSelected();if(record&&this.fireEvent("beforeselect",this,record,a)){var d=record.get(this.getDisplayField()),c=record.get(this.getValueField());this.el.dom.value=d;if(String(this.lastValue)!=String(c)){this.fireEvent("change",this,c,this.lastValue)}this.lastValue=c;this.selectedRecord=record;this.collapse();this.fireEvent("select",this,record,c,d)}},clearValue:function(){delete this.lastValue;this.setRawValue("");delete this.selectedRecord;this.applyEmptyText()},getValue:function(){var a=this.lastValue||"";if(Ext.isEmpty(a)){delete this.selectedRecord}return a},getValueRecord:function(){return this.selectedRecord},getDisplayField:function(){return this.displayField},setDisplayField:function(a){this.displayField=a},getValueField:function(){return this.valueField},setValueField:function(a){this.valueField=a},setValue:function(d){delete this.selectedRecord;var b=this.getValueField(),c=this.getDisplayField(),a;if(!Ext.isEmpty(b,false)&&!Ext.isEmpty(d,false)){this.lastValue=d;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,d);a=b+" = '"+d+"'";a=this.buildProgCondtion(a);this.generalselPanel.query(a,function(g,f){var e=g.query(b,new RegExp("^"+d+"$")).get(0);if(e){this.el.dom.value=e.get(c);var h=this.lastValue;this.lastValue=e.get(b);this.selectedRecord=e;this.fireEvent("change",this,this.lastValue,h);this.fireEvent("passed",this,e.get(b),e)}else{this.fireEvent("unpassed",this,d,b);this.applyEmptyText()}},this)}else{if(d!==undefined&&d.length==0){this.lastValue=d;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,d)}else{this.fireEvent("unpassed",this,d,b);this.applyEmptyText()}}},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.dom.readOnly=true;this.el.addClass("x-trigger-noedit")}else{if(!this.editable){this.el.dom.readOnly=true;this.el.addClass("x-trigger-noedit");this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.dom.readOnly=false;this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}this.trigger.setDisplayed(!this.hideTrigger)}this.onResize(this.width||this.wrap.getWidth())}},setReadOnly:function(a){Rs.ext.form.GridLoaderField.superclass.setReadOnly.apply(this,arguments);this.generalselPanel.setQueryPanelDisable(a==true)},focus:function(){Rs.ext.form.GridLoaderField.superclass.focus.defer(25,this)},isValid:function(a){if(this.disabled){return true}var c=this.preventMark;this.preventMark=a===true;var b=this.validateValue(this.processValue(this.getValue()));this.preventMark=c;return b},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getValue()))){this.clearInvalid();return true}return false},getErrors:function(a){var c=Rs.ext.form.GridLoaderField.superclass.getErrors.apply(this,arguments);a=Ext.isDefined(a)?a:this.processValue(this.getRawValue());var b=this.getValueError(a);b!=undefined?c.push(b):null;return c},getValueError:function(c){if(this.selectedRecord!=undefined){var b=this.getValueField(),a=this.selectedRecord.get(b);if(a!=c){return this.errorValueText}}},onDestroy:function(){if(this.quikTask){this.quikTask.cancel();this.quikTask=null}var a=this.generalselPanel.getGrid();if(a){a.un("rowclick",this.rowClick,this)}this.un("specialkey",this.tabKeyCollapse,this);Rs.ext.form.GridLoaderField.superclass.onDestroy.call(this)},setProgCode:function(a,b){this.progCode=a;this.progCondition=b;this.generalselPanel.setProgCode(this.progCode,this.progCondition)}});Ext.ComponentMgr.registerType("rs-ext-gridloaderfield",Rs.ext.form.GridLoaderField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.Telescope=function(a){a=a||{};Rs.ext.form.Telescope.superclass.constructor.call(this,a);if(this.singleSelect==false){this.setEditable(false)}this.cache={}};Ext.extend(Rs.ext.form.Telescope,Rs.ext.form.GridLoaderField,{separator:",",singleSelect:false,initGeneralselPanel:function(b){if(this.singleSelect==false){b=Ext.apply(b,{gridConfig:Ext.applyIf(b.gridConfig||{},{sm:new Ext.grid.CheckboxSelectionModel()})})}var a=Rs.ext.form.Telescope.superclass.initGeneralselPanel.call(this,b);var c=a.getBottomToolbar();c.add("->");c.add("-");c.addButton({text:"清空",iconCls:"rs-action-clear",handler:this.clear,scope:this});if(this.singleSelect==false){c.addButton({text:"确定",iconCls:"rs-action-submit",handler:this.submit,scope:this})}c.addButton({text:"取消",iconCls:"rs-action-cancel",handler:this.cancel,scope:this});return a},initEvents:function(){Rs.ext.form.Telescope.superclass.initEvents.call(this);var b=this.generalselPanel.getGrid(),a=b?b.getStore():undefined;if(a){a.on("load",this.checkSelected,this,{delay:20,scope:this})}},initLayerEvents:function(){Rs.ext.form.Telescope.superclass.initLayerEvents.call(this);var a=this.generalselPanel.getGrid();if(a){a.on("headerclick",this.selectModelHeaderClick,this,{delay:100,scope:this})}},selectModelHeaderClick:function(b,d){if(this.singleSelect==false){var a=b.getColumnModel();if(a&&a.getColumnAt(d) instanceof Ext.grid.AbstractSelectionModel){this.rowClick(b)}}},doQuery:function(){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.doQuery.call(this)}else{var k=this.getDisplayField(),h=this.getValueField(),g=this.separator,b=[],j,o=[],n,f=[],m,a;if(this.readOnly==true){m=this.getValue();if(!Ext.isEmpty(h,false)&&!Ext.isEmpty(m,false)){o=m.split(g);for(var e=0,c=o.length;e<c;e++){n=o[e];f.push("("+h+" = '"+n+"')")}if(f.length>0){a="("+f.join(" OR ")+")"}else{a="1 <> 1"}}else{a="1 <> 1"}}else{m=this.getRawValue();if(!Ext.isEmpty(k,false)&&!Ext.isEmpty(m,false)){b=m.split(g);for(var e=0,c=b.length;e<c;e++){j=b[e];f.push("("+k+" like '"+j+"%')")}if(f.length>0){a="("+f.join(" OR ")+")"}}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(i,d,l){this.fireEvent("query",this,d,a)},this)}}},setValue:function(s){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.setValue.apply(this,arguments)}else{delete this.selectedRecord;var k=this.getValueField(),q=this.getDisplayField(),j=this.separator,o,p,c=[],n,u,h=[],m=[],t,a,g=[],b;if(!Ext.isEmpty(k,false)&&!Ext.isEmpty(s,false)){this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s);u=s.split(j);for(var f=0,e=u.length;f<e;f++){t=u[f];g.push("("+k+" = '"+t+"')")}if(g.length>0){b="("+g.join(" OR ")+")"}b=this.buildProgCondtion(b);this.generalselPanel.query(b,function(w,v){var r=w.query(k,new RegExp("^"+u.join("|")+"$"));if(r&&r.length>0){for(var y=0,d=r.length;y<d;y++){a=r.get(y);t=a.get(k);n=a.get(q);h.push(t);c.push(n);m.push(a)}o=c.join(j);p=h.join(j);this.el.dom.value=o;var x=this.lastValue;this.lastValue=p;this.selectedRecord=r;this.fireEvent("change",this,this.lastValue,x);this.fireEvent("passed",this,p,r,k);this.rowSelect(m)}else{if(s!==undefined&&s.length==0){this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s)}else{this.fireEvent("unpassed",this,s,k);this.applyEmptyText()}}},this)}else{this.fireEvent("unpassed",this,s,k);this.applyEmptyText()}}},clear:function(){var a=this.generalselPanel.getGrid(),b=a?a.getSelectionModel():undefined;if(b){b.clearSelections()}this.cache={};this.clearValue();this.collapse();this.focus()},submit:function(){var b=this.cache,l=[],c=[],e=[],a,i=this.getDisplayField(),g=this.getValueField(),f=this.separator;for(var d in b){a=b[d];if(a){l.push(a.get(g));c.push(a.get(i));e.push(a)}}if(this.fireEvent("beforeselect",this,e)){var h=c.join(f),j=l.join(f);this.el.dom.value=h;if(String(this.lastValue)!=String(j)){this.fireEvent("change",this,j,this.lastValue)}this.lastValue=j;this.selectedRecord=e;this.collapse();this.fireEvent("select",this,e,j,h)}},cancel:function(){this.collapse();this.focus()},checkSelected:function(n,d){var b=this.cache,a,m,e,h=[],j=this.generalselPanel.getGrid();if(j&&j.rendered){if((sm=j.getSelectionModel())&&sm instanceof Ext.grid.CheckboxSelectionModel){d=d||[];for(var f=0,c=d.length;f<c;f++){a=d[f];m=a&&a.data?a.data:undefined;if(m){e=Rs.hashCode(m);if(b[e]!=undefined){h.push(a)}}}if(h.length>0){sm.selectRecords(h,true)}}}},rowSelect:function(f){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.rowSelect.apply(this,arguments)}else{var e=this.cache,d=f||[],h,c,b;for(var g=0,a=d.length;g<a;g++){h=d[g];c=h&&h.data?h.data:undefined;if(c){b=Rs.hashCode(c);e[b]=h}}}},rowDeSelect:function(e){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.rowDeSelect.apply(this,arguments)}else{var d=e||[],g,c,b;for(var f=0,a=d.length;f<a;f++){g=d[f];c=g&&g.data?g.data:undefined;if(c){b=Rs.hashCode(c);delete this.cache[b]}}}},getValueError:function(){},onDestroy:function(){Rs.ext.form.Telescope.superclass.onDestroy.apply(this,arguments);var a=this.generalselPanel.getStore();if(a){a.un("load",this.checkSelected,this)}var b=this.generalselPanel.getGrid();if(b){b.un("headerclick",this.selectModelHeaderClick,this)}}});Ext.ComponentMgr.registerType("rs-ext-telescope",Rs.ext.form.Telescope)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.SingleUploadField=Ext.extend(Ext.form.TextField,{buttonText:"上传文件",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Rs.ext.form.SingleUploadField.superclass.initComponent.call(this);this.addEvents("fileselected","beforeclick")},onRender:function(c,a){Rs.ext.form.SingleUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var a=this.fileInput.dom.value;if(a){this.setValue(a);this.fireEvent("fileselected",this,a)}}});this.wrap.on("click",function(){this.fireEvent("beforeclick",this)},this)},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Rs.ext.form.SingleUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Rs.ext.form.SingleUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Rs.ext.form.SingleUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Rs.ext.form.SingleUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Rs.ext.form.SingleUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},getUploadPanel:function(){return this.uppanel}});Ext.reg("rs-ext-singleuploadfield",Rs.ext.form.SingleUploadField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.TreeComboBox=Ext.extend(Ext.form.TriggerField,{width:120,initComponent:function(){this.addEvents(["select"]);Rs.ext.form.TreeComboBox.superclass.initComponent.call(this);this.emptyText="选择"+(this.name||"")},onRender:function(a,b){Rs.ext.form.TreeComboBox.superclass.onRender.call(this,a,b);this.el.dom.readOnly=true;this.el.setStyle({cursor:"pointer"});this.el.on("click",this.onTriggerClick,this)},onTriggerClick:function(){if(this.disabled){return}if(!this.view){this.initLayer()}if(this.expanded){this.collapse()}else{this.tree.collapseAll();this.expand()}},initLayer:function(){this.view=new Ext.Layer({constrain:false,shadow:"sides",cls:" x-combo-list "});this.view.swallowEvent("mousewheel");this.view.swallowEvent("mousedown");this.resizer=new Ext.Resizable(this.view,{pinned:true,handles:"se"});this.tree.render(this.view);this.resizer.on("resize",function(c,a,b){this.tree.setWidth(a-2);this.tree.setHeight(b-2)},this);this.on("blur",this.collapse,this);this.tree.getSelectionModel().on("selectionchange",this.onSelect,this)},expand:function(){this.view.alignTo(this.wrap,"tl-bl?");this.view.show();this.expanded=true;Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this)},collapse:function(){this.view.hide();this.expanded=false;Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this)},collapseIf:function(a){if(!a.within(this.wrap)&&!a.within(this.view)){this.collapse()}},onSelect:function(c,a){var b=a.attributes;this.member=b;this.collapse();this.fireEvent("submit",this,b)},getValue:function(){return this.member},setValue:function(a){this.member=a;this.fireEvent("submit",this,a)},onDestroy:function(){Rs.ext.form.TreeComboBox.superclass.onDestroy.call(this);if(this.tree){this.tree.destroy()}if(this.view){this.view.remove()}}});Ext.ComponentMgr.registerType("rs-ext-treecombobox",Rs.ext.form.TreeComboBox)})();